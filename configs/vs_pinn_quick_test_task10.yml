# VS-PINN Channel Flow Re1000 é…ç½®æª”æ¡ˆ
# Variable Scaling Physics-Informed Neural Networks
# ä½¿ç”¨å„å‘ç•°æ€§ç¸®æ”¾æå‡é«˜ Re æ•¸æµå ´çš„è¨“ç·´ç©©å®šæ€§

# åŸºæœ¬å¯¦é©—è¨­å®š
experiment:
  name: "vs_pinn_quick_test_task10"
  version: "v1.0"
  seed: 42
  device: "auto"
  precision: "float32"
  description: "Task-10 Quick Test: 3 New Loss Terms Verification (50 epochs)"

# è³‡æ–™ç›¸é—œè¨­å®š - JHTDB Channel Flow Re1000
data:
  source: "jhtdb"
  dataset: "channel"
  
  jhtdb_config:
    enabled: true
    dataset_name: "channel"
    description: "é€šé“æµ (Re_tau=1000)"
    domain:
      x: [0, 25.13]     # æµå‘ (å‘¨æœŸæ€§)
      y: [-1.0, 1.0]    # å£æ³•å‘
      z: [0, 9.42]      # å±•å‘ (å‘¨æœŸæ€§)
    resolution:
      x: 2048
      y: 512
      z: 1536
    time_range: [0.0, 26.0]
    dt: 0.0065
    variables: ['u', 'v', 'w', 'p']
  
  normalize: true
  cache_dir: "./data/jhtdb/channel_flow_re1000"
  noise_sigma: 0.02
  dropout_prob: 0.10
  
  slice_config:
    plane: "xyz"        # 3D å…¨åŸŸè¨“ç·´
    steady_state: true
    time_average_window: [20.0, 26.0]

# æ„Ÿæ¸¬é»é…ç½®
sensors:
  K: 50               # ç›®æ¨™æ„Ÿæ¸¬é»æ•¸ï¼ˆç ”ç©¶é–€æª»ï¼‰
  selection_method: "qr_pivot"
  sensor_file: "sensors_K50_qr_pivot_3d.npz"
  spatial_coverage: "wall_biased"
  wall_enhancement: true
  wall_region_ratio: 0.4
  log_layer_coverage: true
  
  physics_guided:
    boundary_layer_focus: true
    shear_stress_regions: true
    turbulence_intensity_regions: true

# æ¨¡å‹æ¶æ§‹è¨­å®š
model:
  type: "fourier_mlp"
  in_dim: 3           # (x, y, z) 3D é€šé“æµ
  out_dim: 4          # (u, v, w, p)
  width: 200
  depth: 8
  activation: "sine"  # VS-PINN æ¨è–¦ä½¿ç”¨ sine
  
  fourier_m: 64       # å¢åŠ  Fourier ç‰¹å¾µä»¥æ•æ‰é«˜é »
  fourier_sigma: 5.0
  
  scaling:
    learnable: false  # VS-PINN ä½¿ç”¨å›ºå®šç‰©ç†ç¸®æ”¾
    input_norm: "vs_pinn"
    output_norm: "friction_velocity"

# ç‰©ç†è¨­å®š - VS-PINN æ ¸å¿ƒ
physics:
  type: "vs_pinn_channel_flow"  # ä½¿ç”¨ VS-PINN ç‰©ç†æ¨¡çµ„
  
  # åŸºæœ¬ç‰©ç†åƒæ•¸
  nu: 5.0e-5          # JHTDB channel é‹å‹•é»åº¦
  rho: 1.0
  
  channel_flow:
    Re_tau: 1000.0
    u_tau: 1.0
    pressure_gradient: 0.0025  # dP/dx (é©…å‹•å£“é™)
    
  domain:
    x_range: [0.0, 25.13]
    y_range: [-1.0, 1.0]
    z_range: [0.0, 9.42]
    
  boundary_conditions:
    wall_velocity: [0.0, 0.0, 0.0]  # å£é¢ç„¡æ»‘ç§»
    wall_location: [-1.0, 1.0]      # y = Â±1
    periodic_x: true                 # æµå‘å‘¨æœŸ
    periodic_z: true                 # å±•å‘å‘¨æœŸ
    pressure_driven: true
  
  # ğŸ”‘ VS-PINN å„å‘ç•°æ€§ç¸®æ”¾å› å­
  vs_pinn:
    enabled: true
    scaling_factors:
      N_x: 2.0        # æµå‘ç¸®æ”¾ï¼ˆå‘¨æœŸæ€§ï¼Œè¼ƒå°æ¢¯åº¦ï¼‰
      N_y: 12.0       # å£æ³•å‘ç¸®æ”¾ï¼ˆæœ€å‰›æ€§æ–¹å‘ï¼‰
      N_z: 2.0        # å±•å‘ç¸®æ”¾ï¼ˆå‘¨æœŸæ€§ï¼‰
    
    # Loss æ¬Šé‡è£œå„Ÿï¼ˆæŠµæ¶ˆç¸®æ”¾ç³»æ•¸å½±éŸ¿ï¼‰
    loss_compensation: true
    compensation_factor: 0.00694  # 1 / N_maxÂ² = 1 / 144

# æå¤±å‡½æ•¸æ¬Šé‡ - VS-PINN å„ªåŒ–
losses:
  # åŸºæœ¬æå¤±æ¬Šé‡
  data_weight: 10.0
  boundary_weight: 10.0
  
  # PDE æ®˜å·®æ¬Šé‡ï¼ˆå·²ç”± VS-PINN è‡ªå‹•å¹³è¡¡ï¼‰
  momentum_x_weight: 1.0
  momentum_y_weight: 1.0
  momentum_z_weight: 1.0
  continuity_weight: 1.0
  
  # Channel Flow ç‰¹æœ‰ç´„æŸ
  wall_constraint_weight: 5.0
  periodicity_weight: 2.0
  pressure_gradient_weight: 1.0
  
  # æ–°å¢ç‰©ç†ç´„æŸï¼ˆTask-10 - åŸºæ–¼ Physicist å¯©æŸ¥å»ºè­°ï¼‰
  # åƒè€ƒ: tasks/TASK-10/physics_review_new_losses.md L76-82
  bulk_velocity_weight: 0.2       # æµé‡å®ˆæ†ç´„æŸ L_fluxï¼ˆå…¨åŸŸå¹³å‡ç‰ˆï¼‰
  centerline_dudy_weight: 0.1     # ä¸­å¿ƒç·šå°ç¨±ï¼šâˆ‚u/âˆ‚y|_{y=0} = 0
  centerline_v_weight: 0.1        # ä¸­å¿ƒç·šå°ç¨±ï¼šv|_{y=0} = 0
  pressure_reference_weight: 0.01 # å£“åŠ›åƒè€ƒé»ï¼ˆä½å„ªå…ˆç´šï¼Œå¯é¸ï¼‰
  
  # ç‰©ç†å…ˆé©—èˆ‡æ­£å‰‡åŒ–
  prior_weight: 0.3         # ä½ä¿çœŸå ´è»Ÿå…ˆé©—
  source_l1: 1.0e-6
  gradient_penalty: 1.0e-4
  
  # å‹•æ…‹æ¬Šé‡è¨­å®šï¼ˆèˆ‡ VS-PINN å…¼å®¹ï¼‰
  adaptive_weighting: true
  weighting_method: "gradnorm"
  weight_update_freq: 500
  grad_norm_alpha: 0.12
  
  # æ™‚é–“å› æœæ¬Šé‡ï¼ˆ3D ç©©æ…‹æµå ´ä¸ä½¿ç”¨ï¼‰
  causal_weighting: false

# è¨“ç·´è¨­å®š
training:
  # å¿«é€Ÿé©—è­‰è¨­å®šï¼ˆTask-10ï¼‰
  stage1:
    optimizer: "adam"
    lr: 1.0e-3
    epochs: 50        # å¿«é€Ÿæ¸¬è©¦ï¼š50 epochs
    focus: "boundary_and_data"
    
  stage2:
    optimizer: "lbfgs"
    lr: 1.0
    max_iter: 0       # å¿«é€Ÿæ¸¬è©¦ï¼šè·³é L-BFGS éšæ®µ
    focus: "physics_refinement"
  
  weight_decay: 1.0e-5
  lr_scheduler: "cosine"
  
  max_epochs: 50      # å¿«é€Ÿæ¸¬è©¦ï¼š50 epochs
  batch_size: 1024    # æ¸›å° batch åŠ é€Ÿæ¸¬è©¦
  validation_freq: 10 # æ›´é »ç¹é©—è­‰
  checkpoint_freq: 50 # åªåœ¨æœ€å¾Œå„²å­˜
  
  early_stopping:
    enabled: false    # å¿«é€Ÿæ¸¬è©¦ï¼šç¦ç”¨æ—©åœ
    patience: 2000
    monitor: "val_loss"
    min_delta: 1.0e-6
    
  sampling:
    pde_points: 2048  # æ¸›å°‘æ¡æ¨£é»
    boundary_points: 512
    wall_clustering: 0.5
    
  # VS-PINN å°ˆç”¨èª²ç¨‹å­¸ç¿’
  curriculum:
    enabled: false    # å¿«é€Ÿæ¸¬è©¦ï¼šç¦ç”¨èª²ç¨‹å­¸ç¿’
    schedule: "vs_pinn_gradual"
    stages:
      - epochs: 20
        active_losses: ["boundary", "wall_constraint"]
        sampling_focus: "wall"
        description: "Stage 1: å£é¢é‚Šç•Œæ¢ä»¶"
        
      - epochs: 50
        active_losses: ["all"]
        sampling_focus: "full_domain"
        description: "Stage 2: å…¨ç‰©ç†å ´è¯åˆè¨“ç·´"

# Ensemble èˆ‡ä¸ç¢ºå®šæ€§é‡åŒ–
ensemble:
  enable: false
  n_models: 5
  seeds: [42, 123, 456, 789, 101112]
  uncertainty_quantification: true
  confidence_level: 0.95

# è©•ä¼°è¨­å®š
evaluation:
  grid_resolution: [128, 256, 128]  # (x, y, z) è©•ä¼°ç¶²æ ¼
  
  metrics:
    - "relative_l2"
    - "wall_shear_stress"
    - "velocity_profile"
    - "turbulence_statistics"
    - "pressure_drop"
    - "k_error_curve"           # K é»æ•¸èª¤å·®æ›²ç·š
    - "uncertainty_corr"
    
  thresholds:
    l2_error: 0.15              # VS-PINN ç›®æ¨™èª¤å·®
    wall_shear_error: 0.10
    velocity_profile_error: 0.12
    rmse_improvement: 0.30      # ç›¸å°ä½ä¿çœŸæ”¹å–„
    uq_correlation: 0.6
    min_k_points: 50            # æœ€å°‘æ„Ÿæ¸¬é»æ•¸
    
  channel_flow_validation:
    log_law_region: [30, 300]
    von_karman_constant: 0.41
    wake_parameter: 0.55
    
  # VS-PINN å°ˆç”¨é©—è­‰
  vs_pinn_validation:
    check_scaling_consistency: true
    verify_gradient_balance: true
    monitor_condition_number: true

# æ—¥èªŒèˆ‡å„²å­˜
logging:
  level: "info"
  log_freq: 5         # å¿«é€Ÿæ¸¬è©¦ï¼šæ›´é »ç¹æ—¥èªŒ
  save_predictions: false  # å¿«é€Ÿæ¸¬è©¦ï¼šä¸å„²å­˜é æ¸¬
  save_checkpoints: true
  
  save_velocity_profiles: false
  save_wall_quantities: false
  save_turbulence_fields: false
  
  # VS-PINN å°ˆç”¨ç›£æ§
  vs_pinn_monitoring:
    log_scaling_factors: true
    log_gradient_norms: true
    log_loss_components: true
  
  wandb:
    project: "vs-pinn-task10-test"
    entity: null
    tags: ["task-10", "quick-test", "loss-verification"]

# é‡ç¾æ€§è¨­å®š
reproducibility:
  deterministic: true
  benchmark: false
  num_workers: 4

# Channel Flow Re1000 å°ˆç”¨é©—è­‰è¨­å®š
validation:
  dns_benchmark: true
  dns_data_path: "./data/jhtdb/channel_flow_re1000/dns_reference"
  
  turbulence_statistics:
    reynolds_stress: true
    turbulent_kinetic_energy: true
    dissipation_rate: true
    
  wall_quantities:
    skin_friction: true
    heat_transfer: false
    pressure_fluctuation: true

# æ•ˆèƒ½å„ªåŒ–è¨­å®š
performance:
  mixed_precision: true
  gradient_checkpointing: false
  vectorized_operations: true
  parallel_sampling: true
  max_gpu_memory_fraction: 0.9
  clear_cache_freq: 500

# VS-PINN ç†è«–åƒè€ƒ
reference:
  paper: "Krishnapriyan et al. 2021 - Characterizing possible failure modes in physics-informed neural networks"
  method: "Variable Scaling to balance gradient magnitudes across different PDE terms"
  key_insight: "Anisotropic scaling factors address directional stiffness in high-Re flows"
  implementation: "pinnx/physics/vs_pinn_channel_flow.py"
