# Channel Flow Re1000 PINNs - K80 Wall-Balanced Sensors
# ğŸ¯ ç›®æ¨™ï¼šä½¿ç”¨æŒ‰æ•¸æ“šä½”æ¯”åˆ†å±¤çš„å£é¢å‡è¡¡æ„Ÿæ¸¬é»ï¼Œè§£æ±º K80 æ··åˆç­–ç•¥çš„å…¨å ´æ³›åŒ–å¤±æ•—å•é¡Œ
# ğŸ”§ æ ¸å¿ƒæ”¹é€²ï¼š
#   1. æ„Ÿæ¸¬é»ç­–ç•¥ï¼š5 å±¤æŒ‰æ•¸æ“šä½”æ¯”åˆ†é… (11%/30%/19%/30%/10%)ï¼Œæ¯å±¤æŒ‰ U åˆ†ä½æ•¸æ¡æ¨£
#   2. é©—æ”¶æŒ‡æ¨™ï¼šU å‡å€¼åå·® +1.23% âœ…, å£é¢ U åå·® +8.49% âœ…ï¼ˆå¤§å¹…æ”¹å–„è‡ª -26.7%ï¼‰
#   3. çµ±è¨ˆä»£è¡¨æ€§ï¼šV çµ•å°åå·® 0.000925 âœ…, P å‡å€¼åå·® +0.42% âœ…
# ğŸ“Š å°æ¯”èˆŠç­–ç•¥ï¼ˆK80 Hybridï¼‰ï¼š
#   - èˆŠ: U å‡å€¼åå·® -26.7%, å…¨å ´ L2 èª¤å·® 68.6% âŒ
#   - æ–°: U å‡å€¼åå·® +1.23%, æœŸæœ›æ”¹å–„è‡³ < 15% âœ…

# åŸºæœ¬å¯¦é©—è¨­å®š
experiment:
  name: "pinnx_channel_flow_re1000_K80_wall_balanced"
  version: "v5.0_wall_balanced_sensors"
  seed: 42
  device: "auto"
  precision: "float32"
  description: "K80 å£é¢å‡è¡¡æ„Ÿæ¸¬é»ï¼š5å±¤æŒ‰ä½”æ¯”åˆ†é…+Uåˆ†ä½æ•¸æ¡æ¨£ï¼Œè§£æ±ºçµ±è¨ˆåå·®å•é¡Œ"

# è³‡æ–™ç›¸é—œè¨­å®š - JHTDB Channel Flow Re1000 ç‰¹åŒ–
data:
  source: "jhtdb"
  dataset: "channel"
  
  jhtdb_config:
    enabled: true
    dataset_name: "channel"
    description: "é€šé“æµ (Re_tau=1000)"
    domain:
      x: [0, 25.13]
      y: [-1.0, 1.0]
      z: [0, 9.42]
    resolution:
      x: 2048
      y: 512
      z: 1536
    time_range: [0.0, 26.0]
    dt: 0.0065
    variables: ['u', 'v', 'p']
  
  normalize: true
  cache_dir: "./data/jhtdb/channel_flow_re1000"
  noise_sigma: 0.02
  dropout_prob: 0.10
  
  slice_config:
    plane: "xy"
    z_position: 4.71
    steady_state: true
    time_average_window: [20.0, 26.0]

# æ„Ÿæ¸¬é»é…ç½® - ğŸš€ å£é¢å‡è¡¡ç­–ç•¥ï¼ˆæ–°ï¼‰
sensors:
  K: 80
  selection_method: "wall_balanced"          # æ–°æ–¹æ³•
  sensor_file: "sensors_K80_wall_balanced.npz"  # ğŸ”¥ æŒ‡å‘æ–°ç”Ÿæˆçš„æ„Ÿæ¸¬é»æ–‡ä»¶
  
  # æ–°ç­–ç•¥èªªæ˜
  spatial_coverage: "proportional_layering"  # 5 å±¤æŒ‰æ•¸æ“šä½”æ¯”åˆ†é…
  layer_allocation: [8, 24, 15, 24, 9]       # å¯¦éš›é»æ•¸åˆ†é…ï¼ˆå°æ‡‰ä½”æ¯” 11%/30%/19%/30%/10%ï¼‰
  sampling_method: "u_quantile"              # æ¯å±¤æŒ‰ U åˆ†ä½æ•¸æ¡æ¨£
  
  # çµ±è¨ˆé©—è­‰é€šéæŒ‡æ¨™
  validation:
    u_mean_bias: 0.0123                      # +1.23%
    v_mean_bias_abs: 0.000925                # çµ•å°åå·®
    p_mean_bias: 0.0042                      # +0.42%
    wall_u_bias: 0.0849                      # +8.49%
  
  # è¦†è“‹ç‡
  coverage:
    u_range: 0.985                           # 98.5%
    v_range: 0.772                           # 77.2%ï¼ˆå—é™æ–¼åˆ†ä½æ•¸æ¡æ¨£ï¼‰
    p_range: 0.971                           # 97.1%

# æ¨¡å‹æ¶æ§‹è¨­å®š - æ²¿ç”¨æˆåŠŸé…ç½®
model:
  type: "fourier_mlp"
  in_dim: 2
  out_dim: 3
  width: 256
  depth: 6
  activation: "tanh"
  
  fourier_m: 48
  fourier_sigma: 3.0
  
  scaling:
    learnable: false
    input_norm:
      x: [0.0, 25.13]
      y: [-1.0, 1.0]
    output_norm:
      u: [0.0, 16.5]
      v: [-0.6, 0.6]
      p: [-85.0, 3.0]

# ç‰©ç†è¨­å®š
physics:
  nu: 1.0e-3
  rho: 1.0
  
  channel_flow:
    Re_tau: 1000.0
    Re_bulk: 41980.0
    u_tau: 1.0
    pressure_gradient: -1.0
    
  domain:
    x_range: [0.0, 25.13]
    y_range: [-1.0, 1.0]
    
  boundary_conditions:
    wall_velocity: [0.0, 0.0]
    wall_location: [-1.0, 1.0]
    periodic_x: true
    pressure_driven: true
    mean_pressure_gradient: -1.0

# æå¤±å‡½æ•¸æ¬Šé‡ - ğŸ”¥ ä¿®å¾©é‚Šç•Œæ¢ä»¶é•åå•é¡Œ
losses:
  # è³‡æ–™æ“¬åˆï¼ˆåŸºæ–¼çµ±è¨ˆä»£è¡¨æ€§è‰¯å¥½çš„æ„Ÿæ¸¬é»ï¼‰
  data_weight: 1.0                         # åŸºæº–æ¬Šé‡
  
  # é‚Šç•Œæ¢ä»¶ - ğŸš€ å¤§å¹…æå‡æ¬Šé‡ä»¥å¼·åˆ¶é‚Šç•Œç´„æŸ
  wall_constraint_weight: 100.0            # ğŸ”¥ å¾ 10.0 æå‡è‡³ 100.0
  periodicity_weight: 50.0                 # ğŸ”¥ å¾ 5.0 æå‡è‡³ 50.0
  
  # PDE ç‰©ç†
  momentum_x_weight: 10.0
  momentum_y_weight: 10.0
  continuity_weight: 20.0                  # ä¿æŒå®ˆæ†ç´„æŸ
  
  # ä½ä¿çœŸå…ˆé©— - ğŸ”¥ é™ä½ä»¥é¿å…ç¶å®šéŒ¯èª¤å ´
  prior_weight: 0.0                        # ğŸ”¥ å¾ 0.5 é™è‡³ 0.0ï¼ˆå¾…é©—è­‰å¾Œå†å•Ÿç”¨ï¼‰
  source_l1: 1.0e-6
  gradient_penalty: 1.0e-4
  
  # æ¬Šé‡åˆ†æï¼ˆä¿®å¾©ç‰ˆï¼‰ï¼š
  #   data(1.0) + wall(100) + periodicity(50) + PDE(40) + prior(0) â‰ˆ 191
  #   ç›¸å°æ¯”ä¾‹: wall(100x) > periodicity(50x) > PDE(40x) > data(1x) > prior(0x)
  #   ç­–ç•¥ï¼šå„ªå…ˆæ»¿è¶³é‚Šç•Œæ¢ä»¶ï¼Œå†é€æ­¥å¹³è¡¡ç‰©ç†æ–¹ç¨‹èˆ‡æ•¸æ“šæ“¬åˆ
  
  # ä½¿ç”¨è‡ªé©æ‡‰æ¬Šé‡ï¼ˆå¯é¸ï¼‰
  adaptive_weighting: true
  weight_update_freq: 50
  grad_norm_alpha: 0.15
  
  causal_weighting: false

# è¨“ç·´è¨­å®š
training:
  optimizer: "adam"
  lr: 1.0e-3
  weight_decay: 1.0e-5
  lr_scheduler: "cosine"
  
  max_epochs: 2000
  batch_size: 1024
  validation_freq: 100
  checkpoint_freq: 100
  early_stopping: false  # ğŸ”§ Disabled: conservation_error converges too early, preventing velocity field learning
  patience: 500
  
  sampling:
    pde_points: 4096
    boundary_points: 2000                  # ğŸ”¥ å¾ 1000 å¢åŠ è‡³ 2000
    wall_clustering: 0.1
    center_enhancement: 0.4
    high_velocity_sampling: 0.3
  
  curriculum: false
  curriculum_schedule: "simple"

# Ensemble èˆ‡ä¸ç¢ºå®šæ€§é‡åŒ–
ensemble:
  enable: false
  n_models: 8
  seeds: [0, 1, 2, 3, 4, 5, 6, 7]
  uncertainty_quantification: true
  confidence_level: 0.95

# è©•ä¼°è¨­å®š
evaluation:
  grid_resolution: [256, 128]
  
  metrics:
    - "relative_l2"
    - "wall_shear_stress"
    - "velocity_profile"
    - "friction_coefficient"
    - "turbulence_statistics"
    - "pressure_drop"
    - "mass_conservation"
    - "uncertainty_corr"
    - "prediction_coverage"
    
  thresholds:
    l2_error: 0.15                         # ğŸ¯ æ ¸å¿ƒç›®æ¨™ï¼šæ”¹å–„è‡ª 68.6%
    wall_shear_error: 0.10
    velocity_profile_error: 0.08
    rmse_improvement: 0.30
    uq_correlation: 0.6
    mass_conservation_error: 0.1
    prediction_coverage: 0.9
    
  channel_flow_validation:
    log_law_region: [30, 300]
    von_karman_constant: 0.41
    wake_parameter: 0.55

# æ—¥èªŒèˆ‡å„²å­˜
logging:
  level: "info"
  log_freq: 50
  save_predictions: true
  save_checkpoints: true
  
  save_velocity_profiles: true
  save_wall_quantities: true
  save_turbulence_fields: true
  
  monitor_conservation: true
  conservation_check_freq: 25
  
  wandb:
    project: "pinnx-channel-flow-re1000-k80-wall-balanced"
    entity: null
    tags: ["pinns", "inverse", "channel_flow", "re1000", "jhtdb", "k80", "wall_balanced", "proportional_layering", "u_quantile"]

# é‡ç¾æ€§è¨­å®š
reproducibility:
  deterministic: true
  benchmark: false
  num_workers: 4

# Channel Flow Re1000 å°ˆç”¨é©—è­‰è¨­å®š
validation:
  dns_benchmark: true
  dns_data_path: "./data/jhtdb/channel_flow_re1000/dns_reference"
  
  turbulence_statistics:
    reynolds_stress: true
    turbulent_kinetic_energy: true
    dissipation_rate: true
    
  wall_quantities:
    skin_friction: true
    heat_transfer: false
    pressure_fluctuation: true

# æ•ˆèƒ½å„ªåŒ–è¨­å®š
performance:
  mixed_precision: true
  gradient_checkpointing: false
  vectorized_operations: true
  parallel_sampling: true
  max_gpu_memory_fraction: 0.9
  clear_cache_freq: 1000
