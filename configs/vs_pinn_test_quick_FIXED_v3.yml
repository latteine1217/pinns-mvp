# VS-PINN å¿«é€Ÿæ¸¬è©¦é…ç½® - ä¿®æ­£ç‰ˆ v3 (çµ„åˆç­–ç•¥)
# æ–¹æ¡ˆ Aï¼ˆéƒ¨åˆ†æœ‰æ•ˆï¼‰ï¼šåˆ†å±¤æ¬Šé‡ momentum_y=1.0ï¼ŒResidual å¢é•·å¾ 3.9x â†’ 3.1x
# æ–¹æ¡ˆ B+C çµ„åˆï¼š
#   1. ç¦ç”¨æ­¸ä¸€åŒ– Warmupï¼ˆç«‹å³æ­¸ä¸€åŒ–ï¼Œé¿å…æ—©æœŸå¤±è¡¡ï¼‰
#   2. å¤§å¹…é™ä½ Data æ¬Šé‡ï¼ˆ10.0 â†’ 1.0ï¼Œé¿å…æ¢¯åº¦ä¸»å°ï¼‰
#   3. ä¿æŒåˆ†å±¤æ¬Šé‡ç­–ç•¥ï¼ˆmomentum_y=1.0ï¼‰

# åŸºæœ¬å¯¦é©—è¨­å®š
experiment:
  name: "vs_pinn_test_quick_FIXED_v3"
  version: "v1.3-combined-strategy"
  seed: 42
  device: "auto"
  precision: "float32"
  description: "Combined strategy: layered weights + no warmup + reduced data weight"

# è³‡æ–™ç›¸é—œè¨­å®š - ç°¡åŒ–é…ç½®
data:
  source: "jhtdb"
  dataset: "channel"
  
  jhtdb_config:
    enabled: true
    dataset_name: "channel"
    description: "é€šé“æµ (Re_tau=1000) - æ¸¬è©¦ç”¨"
    domain:
      x: [0, 25.13]
      y: [-1.0, 1.0]
      z: [0, 9.42]
    resolution:
      x: 2048
      y: 512
      z: 1536
    time_range: [0.0, 26.0]
    dt: 0.0065
    variables: ['u', 'v', 'w', 'p']
  
  normalize: true
  cache_dir: "./data/jhtdb/channel_flow_re1000"
  noise_sigma: 0.02
  dropout_prob: 0.10
  
  slice_config:
    plane: "xyz"
    steady_state: true
    time_average_window: [20.0, 26.0]

# æ„Ÿæ¸¬é»é…ç½® - æ¸›å°‘é»æ•¸
sensors:
  K: 30               # æ¸¬è©¦ç”¨è¼ƒå°‘é»æ•¸
  selection_method: "qr_pivot"
  sensor_file: "sensors_K30_qr_pivot_3d_true.npz"  # ä½¿ç”¨çœŸæ­£çš„ 3D æ•¸æ“š
  spatial_coverage: "wall_biased"
  wall_enhancement: true
  wall_region_ratio: 0.4
  log_layer_coverage: true

# æ¨¡å‹æ¶æ§‹è¨­å®š - ä¿æŒèˆ‡æ­£å¼ç‰ˆä¸€è‡´
model:
  type: "fourier_mlp"
  in_dim: 3
  out_dim: 4
  width: 200
  depth: 8
  activation: "sine"
  
  fourier_m: 64
  fourier_sigma: 5.0
  
  scaling:
    learnable: false
    input_norm: "vs_pinn"
    output_norm: "friction_velocity"

# ç‰©ç†è¨­å®š - VS-PINN æ ¸å¿ƒ
physics:
  type: "vs_pinn_channel_flow"
  
  nu: 5.0e-5
  rho: 1.0
  
  channel_flow:
    Re_tau: 1000.0
    u_tau: 1.0
    pressure_gradient: 0.0025
    
  domain:
    x_range: [0.0, 25.13]
    y_range: [-1.0, 1.0]
    z_range: [0.0, 9.42]
    
  boundary_conditions:
    wall_velocity: [0.0, 0.0, 0.0]
    wall_location: [-1.0, 1.0]
    periodic_x: true
    periodic_z: true
    pressure_driven: true
  
  # VS-PINN å„å‘ç•°æ€§ç¸®æ”¾å› å­
  vs_pinn:
    enabled: true
    scaling_factors:
      N_x: 2.0
      N_y: 12.0
      N_z: 2.0
    
    loss_compensation: true
    compensation_factor: 0.00694  # 1 / N_maxÂ²

# æå¤±å‡½æ•¸æ¬Šé‡ - çµ„åˆç­–ç•¥ï¼ˆv3ï¼‰
# ä¿®æ­£ 1ï¼šmomentum_y_weight: 100.0 â†’ 1.0ï¼ˆåˆ†å±¤å£“åˆ¶ï¼‰
# ä¿®æ­£ 2ï¼šdata_weight: 10.0 â†’ 1.0ï¼ˆé¿å… Data Loss ä¸»å°æ¢¯åº¦ï¼‰
# ä¿®æ­£ 3ï¼šboundary_weight: 10.0 â†’ 5.0ï¼ˆç›¸æ‡‰èª¿æ•´ï¼‰
losses:
  data_weight: 1.0            # ğŸ”´ ä¿®æ­£ 2ï¼š10.0 â†’ 1.0ï¼ˆé¿å…æ¢¯åº¦ä¸»å°ï¼‰
  boundary_weight: 5.0        # ğŸ”´ ä¿®æ­£ 3ï¼š10.0 â†’ 5.0ï¼ˆä¿æŒå¹³è¡¡ï¼‰
  
  momentum_x_weight: 100.0   # ä¿æŒé«˜æ¬Šé‡
  momentum_y_weight: 1.0     # ğŸ”´ ä¿®æ­£ 1ï¼š100.0 â†’ 1.0ï¼ˆåˆ†å±¤å£“åˆ¶ï¼‰
  momentum_z_weight: 100.0   # ä¿æŒé«˜æ¬Šé‡
  continuity_weight: 100.0   # ä¿æŒé«˜æ¬Šé‡
  
  wall_constraint_weight: 15.0
  periodicity_weight: 2.0
  pressure_gradient_weight: 1.0
  
  prior_weight: 0.3
  source_l1: 1.0e-6
  gradient_penalty: 1.0e-4
  
  adaptive_weighting: true
  weighting_method: "gradnorm"
  weight_update_freq: 100
  grad_norm_alpha: 0.12
  
  causal_weighting: false
  
  # ğŸ”´ ä¿®æ­£ 4ï¼šç¦ç”¨æ­¸ä¸€åŒ– Warmupï¼ˆç«‹å³æ­¸ä¸€åŒ–ï¼Œé¿å…æ—©æœŸå¤±è¡¡ï¼‰
  warmup_epochs: 0  # æ–°å¢ï¼šå¾ 5 â†’ 0

# è¨“ç·´è¨­å®š - å¤§å¹…ç°¡åŒ–
training:
  # åƒ…ä½¿ç”¨ Adamï¼ˆè·³é L-BFGS éšæ®µï¼‰
  stage1:
    optimizer: "adam"
    lr: 1.0e-3
    epochs: 50  # æ¥µçŸ­æ¸¬è©¦ï¼ˆåƒ…é©—è­‰æµç¨‹ï¼‰
    focus: "boundary_and_data"
    
  weight_decay: 1.0e-5
  lr_scheduler: "cosine"
  
  max_epochs: 50  # æ¥µçŸ­æ¸¬è©¦
  batch_size: 512  # æ›´å° batch size
  validation_freq: 10
  checkpoint_freq: 50
  
  early_stopping:
    enabled: false  # æ¸¬è©¦æ™‚ä¸ä½¿ç”¨
    
  sampling:
    pde_points: 1024   # æ¥µå°‘ PDE é»æ•¸
    boundary_points: 128
    wall_clustering: 0.5
    
  # ç¦ç”¨èª²ç¨‹å­¸ç¿’ï¼ˆç°¡åŒ–æ¸¬è©¦ï¼‰
  curriculum:
    enabled: false

# Ensemble èˆ‡ä¸ç¢ºå®šæ€§é‡åŒ–
ensemble:
  enable: false

# è©•ä¼°è¨­å®š - ç°¡åŒ–
evaluation:
  grid_resolution: [64, 128, 64]  # ä½è§£æåº¦è©•ä¼°
  
  metrics:
    - "relative_l2"
    - "wall_shear_stress"
    - "velocity_profile"
    
  thresholds:
    l2_error: 0.30  # æ¸¬è©¦æ™‚æ”¾å¯¬
    wall_shear_error: 0.20
    
  vs_pinn_validation:
    check_scaling_consistency: true
    verify_gradient_balance: true
    monitor_condition_number: false  # æ¸¬è©¦æ™‚è·³é

# æ—¥èªŒèˆ‡å„²å­˜
logging:
  level: "info"
  log_freq: 20  # æ›´é »ç¹æ—¥èªŒ
  save_predictions: true
  save_checkpoints: true
  
  save_velocity_profiles: true
  save_wall_quantities: true
  save_turbulence_fields: false
  
  vs_pinn_monitoring:
    log_scaling_factors: true
    log_gradient_norms: true
    log_loss_components: true
  
  wandb:
    project: "vs-pinn-test-fixed-v3"
    entity: null
    tags: ["vs-pinn", "test", "quick", "fixed-v3", "combined-strategy", "no-warmup", "reduced-data-weight"]

# é‡ç¾æ€§è¨­å®š
reproducibility:
  deterministic: true
  benchmark: false
  num_workers: 2

# æ•ˆèƒ½å„ªåŒ–è¨­å®š
performance:
  mixed_precision: false  # æ¸¬è©¦æ™‚é—œé–‰
  gradient_checkpointing: false
  vectorized_operations: true
  parallel_sampling: false
  max_gpu_memory_fraction: 0.8
  clear_cache_freq: 100

# æ¸¬è©¦æ¨¡å¼å°ˆç”¨
test_mode:
  enabled: true
  skip_data_download: true  # ä½¿ç”¨å·²å¿«å–çš„è³‡æ–™
  minimal_logging: false
  fast_dev_run: false
