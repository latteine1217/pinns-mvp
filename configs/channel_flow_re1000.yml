# Channel Flow Re1000 PINNs é€†é‡å»ºå°ˆç”¨é…ç½®æª”æ¡ˆ
# åŸºæ–¼ç´„ç¿°éœæ™®é‡‘æ–¯æ¹æµè³‡æ–™åº« (JHTDB) Channel Flow Re_tau=1000 è³‡æ–™é›†
# å°ˆç”¨æ–¼å¾ç¨€ç–æ„Ÿæ¸¬é»é‡å»ºå®Œæ•´æ¹æµå ´çš„ PINNs é€†å•é¡Œ

# åŸºæœ¬å¯¦é©—è¨­å®š
experiment:
  name: "pinnx_channel_flow_re1000"
  version: "v1.0"
  seed: 42
  device: "auto"  # autoæœƒè‡ªå‹•é¸æ“‡æœ€ä½³è¨­å‚™ (CUDA > MPS > CPU)
  precision: "float32"
  description: "Channel Flow Re1000 ç¨€ç–é‡å»ºå¯¦é©—"

# è³‡æ–™ç›¸é—œè¨­å®š - JHTDB Channel Flow Re1000 ç‰¹åŒ–
data:
  # é«˜ä¿çœŸè³‡æ–™ä¾†æº - JHTDB Channel Flow
  source: "jhtdb"
  dataset: "channel"  # Re_tau=1000 é€šé“æµ
  
  # JHTDB Channel Flow Re1000 è³‡æ–™é›†åƒæ•¸
  jhtdb_config:
    enabled: true                   # ğŸ”§ ä¿®å¾©ï¼šæ˜ç¢ºå•Ÿç”¨JHTDBè¼‰å…¥
    dataset_name: "channel"
    description: "é€šé“æµ (Re_tau=1000)"
    # å¯¦éš›JHTDBåŸŸç¯„åœ (åŸºæ–¼æ‘©æ“¦é€Ÿåº¦u_tauæ¨™æº–åŒ–)
    domain:
      x: [0, 25.13]      # x âˆˆ [0, 8Ï€] æµå‘ (é€±æœŸæ€§)
      y: [-1.0, 1.0]     # y âˆˆ [-1, 1] å£æ³•å‘ (å£é¢æ¢ä»¶)
      z: [0, 9.42]       # z âˆˆ [0, 3Ï€] å±•å‘ (é€±æœŸæ€§)
    resolution:
      x: 2048
      y: 512
      z: 1536
    time_range: [0.0, 26.0]
    dt: 0.0065
    variables: ['u', 'v', 'w', 'p']
  
  # è³‡æ–™é è™•ç†
  normalize: true
  cache_dir: "./data/jhtdb/channel_flow_re1000"
  
  # å™ªè²èˆ‡éºå¤±è¨­å®š (æ¨¡æ“¬çœŸå¯¦æ„Ÿæ¸¬ç’°å¢ƒ)
  noise_sigma: 0.02  # 2% é«˜æ–¯å™ªè²
  dropout_prob: 0.10  # 10% éš¨æ©Ÿéºå¤±
  
  # 2Dåˆ‡ç‰‡é…ç½® (å¾3Då ´æå–2Dé€²è¡Œåˆå§‹é©—è­‰)
  slice_config:
    plane: "xy"        # æå– x-y å¹³é¢ (æµå‘-å£æ³•å‘)
    z_position: 4.71   # z = 3Ï€/2 ä½ç½®åˆ‡ç‰‡
    steady_state: true # ä½¿ç”¨æ™‚é–“å¹³å‡å ´
    time_average_window: [20.0, 26.0]  # çµ±è¨ˆç©©æ…‹æ™‚é–“çª—å£

# æ„Ÿæ¸¬é»é…ç½® - é‡å°Channel Flowå„ªåŒ–
sensors:
  K: 20  # æ„Ÿæ¸¬é»æ•¸é‡ - æ¨™æº–åŒ–ç‚º20å€‹é»
  selection_method: "qr_pivot"  # QR-pivotæœ€é©æ„Ÿæ¸¬é…ç½®
  spatial_coverage: "wall_biased"  # åå‘å£é¢å€åŸŸè¦†è“‹
  
  # Channel Flow ç‰¹æœ‰æ„Ÿæ¸¬ç­–ç•¥
  wall_enhancement: true     # å¼·åŒ–è¿‘å£é¢æ„Ÿæ¸¬
  wall_region_ratio: 0.4     # 40% æ„Ÿæ¸¬é»é…ç½®åœ¨ y+ < 30 å€åŸŸ
  log_layer_coverage: true   # ç¢ºä¿å°æ•¸å¾‹å±¤è¦†è“‹
  
  # ç‰©ç†å¼•å°çš„æ„Ÿæ¸¬é»åˆ†ä½ˆ
  physics_guided:
    boundary_layer_focus: true
    shear_stress_regions: true
    turbulence_intensity_regions: true

# æ¨¡å‹æ¶æ§‹è¨­å®š - Channel Flow Re1000 å„ªåŒ–
model:
  type: "fourier_mlp"
  
  # ç¶²è·¯çµæ§‹ - é‡å°Channel Flow Re1000èª¿æ•´
  in_dim: 2     # [x, y] å®šå¸¸2Dåˆ‡ç‰‡é‡å»º
  out_dim: 4    # [u, v, p, S] (æµå‘é€Ÿåº¦ã€å£æ³•å‘é€Ÿåº¦ã€å£“åŠ›ã€æºé …)
  width: 256    # å¹³è¡¡ç²¾åº¦èˆ‡æ•ˆç‡
  depth: 6      # è¶³å¤ æ·±åº¦æ•æ‰å£é¢å±¤-å°æ•¸å¾‹å±¤-æ ¸å¿ƒå€è½‰æ›
  activation: "tanh"
  
  # Fourier Features - Channel Flow å¤šå°ºåº¦å„ªåŒ–
  fourier_m: 48  # æ•æ‰Channel Flowå¤šå°ºåº¦çµæ§‹
  fourier_sigma: 3.0  # é©æ‡‰å£é¢é«˜æ¢¯åº¦å€åŸŸ
  
  # VS-PINN è®Šæ•¸å°ºåº¦åŒ– - Re1000ç‰¹åŒ–
  scaling:
    learnable: true
    input_norm: "channel_flow"  # å°ˆç”¨æ¨™æº–åŒ– (å£é¢åº§æ¨™)
    output_norm: "friction_velocity"  # åŸºæ–¼æ‘©æ“¦é€Ÿåº¦æ¨™æº–åŒ–
    # Channel Flowç‰¹æœ‰å°ºåº¦åƒæ•¸
    friction_velocity: 1.0  # u_tauåƒè€ƒå€¼
    channel_half_height: 1.0  # håƒè€ƒå€¼
    viscous_length: 1.0e-3  # Î´_Î½ = Î½/u_tau

# ç‰©ç†è¨­å®š - Channel Flow Re1000 ç²¾ç¢ºåƒæ•¸
physics:
  # æµé«”åƒæ•¸ (Re_tau = 1000)
  nu: 1.0e-3       # å‹•åŠ›é»æ€§ä¿‚æ•¸ Î½ = 1/Re_tau
  rho: 1.0         # å¯†åº¦ (æ¨™æº–åŒ–)
  
  # Channel Flow ç‰¹æœ‰åƒæ•¸
  channel_flow:
    Re_tau: 1000.0              # æ‘©æ“¦é›·è«¾æ•¸
    Re_bulk: 41980.0            # é«”ç©é›·è«¾æ•¸ (è¿‘ä¼¼)
    u_tau: 1.0                  # æ‘©æ“¦é€Ÿåº¦ (æ¨™æº–åŒ–)
    pressure_gradient: -1.0     # ä¸»æµæ–¹å‘å£“åŠ›æ¢¯åº¦
    
  # è¨ˆç®—åŸŸ (æ¨™æº–åŒ–åˆ°ç‰©ç†å–®ä½)
  domain:
    x_range: [0.0, 25.13]    # 8Ï€æµå‘é•·åº¦
    y_range: [-1.0, 1.0]     # å£é¢åº§æ¨™
    
  # é‚Šç•Œæ¢ä»¶ - Channel Flow
  boundary_conditions:
    # å£é¢æ¢ä»¶
    wall_velocity: [0.0, 0.0]   # ç„¡æ»‘ç§»æ¢ä»¶
    wall_location: [-1.0, 1.0]  # ä¸Šä¸‹å£é¢ä½ç½®
    
    # é€±æœŸæ€§æ¢ä»¶
    periodic_x: true             # æµå‘é€±æœŸæ€§
    
    # å£“åŠ›æ¢¯åº¦é©±åŠ¨
    pressure_driven: true
    mean_pressure_gradient: -1.0

# æå¤±å‡½æ•¸æ¬Šé‡ - Channel Flow Re1000 èª¿å„ª
losses:
  # åŸºæœ¬æå¤±æ¬Šé‡
  data_weight: 10.0     # å¼·åŒ–è§€æ¸¬è³‡æ–™ä¸€è‡´æ€§
  boundary_weight: 10.0  # å£é¢ç„¡æ»‘ç§»æ¢ä»¶
  
  # PDE æ®˜å·®æ¬Šé‡
  momentum_x_weight: 1.0    # æµå‘å‹•é‡æ–¹ç¨‹
  momentum_y_weight: 1.0    # å£æ³•å‘å‹•é‡æ–¹ç¨‹
  continuity_weight: 1.0    # é€£çºŒæ–¹ç¨‹
  
  # Channel Flow ç‰¹æœ‰ç´„æŸ
  wall_constraint_weight: 5.0      # å£é¢ç„¡æ»‘ç§»å¼·åŒ–
  periodicity_weight: 2.0          # é€±æœŸæ€§é‚Šç•Œç´„æŸ
  pressure_gradient_weight: 1.0    # å£“åŠ›æ¢¯åº¦ç´„æŸ
  
  # ç‰©ç†å…ˆé©—èˆ‡æ­£å‰‡åŒ–
  prior_weight: 0.3         # RANS/LESä½ä¿çœŸå…ˆé©—
  source_l1: 1.0e-6        # æºé …ç¨€ç–æ­£å‰‡åŒ–
  gradient_penalty: 1.0e-4  # å£é¢æ¢¯åº¦æ‡²ç½°
  
  # å‹•æ…‹æ¬Šé‡è¨­å®š
  adaptive_weighting: true
  weight_update_freq: 1000
  grad_norm_alpha: 0.9
  
  # æ™‚é–“å› æœæ¬Šé‡ (2Då®šå¸¸å ´ä¸éœ€è¦)
  causal_weighting: false

# è¨“ç·´è¨­å®š - Channel Flow Re1000 ç©©å®šåŒ–
training:
  # æœ€ä½³åŒ–å™¨
  optimizer: "adam"
  lr: 8.0e-4              # é‡å°Channel Flowèª¿æ•´
  weight_decay: 1.0e-5
  lr_scheduler: "cosine"
  
  # è¨“ç·´åƒæ•¸
  max_epochs: 15000       # Channel Flow æ”¶æ–‚è¼ƒå¿«
  batch_size: 1024
  validation_freq: 500
  checkpoint_freq: 2000
  early_stopping: true
  patience: 3000
  
  # å–æ¨£ç­–ç•¥ - Channel Flow å„ªåŒ–
  sampling:
    pde_points: 4096     # PDE æ®˜å·®è¨ˆç®—é»æ•¸ - æ¨™æº–åŒ–ç‚º4096å€‹é»
    boundary_points: 1000 # å£é¢æ¡æ¨£
    wall_clustering: 0.3  # 30% é»é›†ä¸­åœ¨è¿‘å£é¢å€åŸŸ (y+ < 30)
    
  # èª²ç¨‹å­¸ç¿’ - Channel Flow éšæ®µè¨“ç·´
  curriculum: true
  curriculum_schedule: "exponential"
  curriculum_stages:
    - epochs: 50        # éšæ®µ1ï¼šå£é¢é‚Šç•Œæ¢ä»¶
      active_losses: ["boundary", "wall_constraint"]
      sampling_focus: "wall"
    - epochs: 150       # éšæ®µ2ï¼šåŠ å…¥å‹•é‡æ–¹ç¨‹
      active_losses: ["boundary", "wall_constraint", "momentum"]
      sampling_focus: "boundary_layer"
    - epochs: -1        # éšæ®µ3ï¼šå®Œæ•´ç‰©ç†ç´„æŸ
      active_losses: ["all"]
      sampling_focus: "full_domain"

# Ensemble èˆ‡ä¸ç¢ºå®šæ€§é‡åŒ–
ensemble:
  enable: false  # å–®æ¨¡å‹å…ˆé©—è­‰ï¼Œå¾ŒçºŒå¯é–‹å•ŸUQåˆ†æ
  n_models: 8
  seeds: [0, 1, 2, 3, 4, 5, 6, 7]
  uncertainty_quantification: true
  confidence_level: 0.95

# è©•ä¼°è¨­å®š - Channel Flow å°ˆç”¨æŒ‡æ¨™
evaluation:
  # è©•ä¼°ç¶²æ ¼ (ç¬¦åˆChannel Flowè§£æåº¦)
  grid_resolution: [256, 128]  # [x, y] æ–¹å‘
  
  # Channel Flow å°ˆç”¨è©•ä¼°æŒ‡æ¨™
  metrics:
    - "relative_l2"           # ç›¸å° L2 èª¤å·®
    - "wall_shear_stress"     # å£é¢å‰ªæ‡‰åŠ› (é—œéµChannel FlowæŒ‡æ¨™)
    - "velocity_profile"      # é€Ÿåº¦å‰–é¢ (å°æ•¸å¾‹é©—è­‰)
    - "friction_coefficient"  # æ‘©æ“¦ä¿‚æ•¸
    - "turbulence_statistics" # æ¹æµçµ±è¨ˆé‡
    - "pressure_drop"         # å£“é™
    - "uncertainty_corr"      # UQ ç›¸é—œæ€§ (ensembleæ¨¡å¼)
    
  # æˆåŠŸé–€æª» - Channel Flow Re1000 æ¨™æº–
  thresholds:
    l2_error: 0.10              # â‰¤ 10% L2 èª¤å·®
    wall_shear_error: 0.05      # â‰¤ 5% å£é¢å‰ªæ‡‰åŠ›èª¤å·®
    velocity_profile_error: 0.08 # â‰¤ 8% é€Ÿåº¦å‰–é¢èª¤å·®
    rmse_improvement: 0.30      # â‰¥ 30% å°ä½ä¿çœŸæ”¹å–„
    uq_correlation: 0.6         # r â‰¥ 0.6 UQç›¸é—œæ€§
    
  # Channel Flow ç‰¹æœ‰é©—è­‰
  channel_flow_validation:
    log_law_region: [30, 300]   # y+ å°æ•¸å¾‹å€åŸŸé©—è­‰
    von_karman_constant: 0.41   # å¡é–€å¸¸æ•¸é©—è­‰
    wake_parameter: 0.55        # å°¾æµåƒæ•¸é©—è­‰

# æ—¥èªŒèˆ‡å„²å­˜
logging:
  level: "info"
  log_freq: 100
  save_predictions: true
  save_checkpoints: true
  
  # Channel Flow å°ˆç”¨è¼¸å‡º
  save_velocity_profiles: true  # ä¿å­˜é€Ÿåº¦å‰–é¢
  save_wall_quantities: true    # ä¿å­˜å£é¢é‡
  save_turbulence_fields: true  # ä¿å­˜æ¹æµå ´
  
  wandb:
    project: "pinnx-channel-flow-re1000"
    entity: null
    tags: ["pinns", "inverse", "channel_flow", "re1000", "jhtdb"]

# é‡ç¾æ€§è¨­å®š
reproducibility:
  deterministic: true
  benchmark: false
  num_workers: 4

# Channel Flow Re1000 å°ˆç”¨é©—è­‰è¨­å®š
validation:
  # èˆ‡ DNS åŸºæº–æ¯”è¼ƒ
  dns_benchmark: true
  dns_data_path: "./data/jhtdb/channel_flow_re1000/dns_reference"
  
  # æ¹æµçµ±è¨ˆé©—è­‰
  turbulence_statistics:
    reynolds_stress: true      # é›·è«¾èŒ²æ‡‰åŠ›
    turbulent_kinetic_energy: true  # æ¹å‹•èƒ½
    dissipation_rate: true     # è€—æ•£ç‡
    
  # å£é¢é‡é©—è­‰
  wall_quantities:
    skin_friction: true        # è¡¨é¢æ‘©æ“¦
    heat_transfer: false       # ç†±å‚³é (å¦‚éœ€è¦)
    pressure_fluctuation: true # å£“åŠ›è„ˆå‹•

# æ•ˆèƒ½å„ªåŒ–è¨­å®š
performance:
  # GPU è¨˜æ†¶é«”å„ªåŒ–
  mixed_precision: true      # æ··åˆç²¾åº¦è¨“ç·´
  gradient_checkpointing: false
  
  # è¨ˆç®—å„ªåŒ–
  vectorized_operations: true
  parallel_sampling: true
  
  # è¨˜æ†¶é«”ç®¡ç†
  max_gpu_memory_fraction: 0.9
  clear_cache_freq: 1000