# Channel Flow Re1000 PINNs - Normalized Weighting
# K=50 æ„Ÿæ¸¬é» + æ¨™æº–åŒ–æ¬Šé‡ + Data/Boundary çµ±ä¸€æ¬Šé‡ + 1000 epochs

# åŸºæœ¬å¯¦é©—è¨­å®š
experiment:
  name: "pinnx_channel_flow_re1000_fix6_k50_normalized"
  version: "v1.4_normalized"
  seed: 42
  device: "auto"
  precision: "float32"
  description: "K=50 + Normalized Weights + Equal Data/BC + 1000 epochs"

# è³‡æ–™ç›¸é—œè¨­å®š - JHTDB Channel Flow Re1000 ç‰¹åŒ–
data:
  source: "jhtdb"
  dataset: "channel"
  
  jhtdb_config:
    enabled: true
    dataset_name: "channel"
    description: "é€šé“æµ (Re_tau=1000)"
    domain:
      x: [0, 25.13]
      y: [-1.0, 1.0]
      z: [0, 9.42]
    resolution:
      x: 2048
      y: 512
      z: 1536
    time_range: [0.0, 26.0]
    dt: 0.0065
    variables: ['u', 'v', 'w', 'p']
  
  normalize: true
  cache_dir: "./data/jhtdb/channel_flow_re1000"
  noise_sigma: 0.02
  dropout_prob: 0.10
  
  slice_config:
    plane: "xy"
    z_position: 4.71
    steady_state: true
    time_average_window: [20.0, 26.0]

# æ„Ÿæ¸¬é»é…ç½®
sensors:
  K: 50
  selection_method: "qr_pivot"
  sensor_file: "sensors_K50_qr_pivot.npz"
  spatial_coverage: "wall_biased"
  wall_enhancement: true
  wall_region_ratio: 0.4
  log_layer_coverage: true
  
  physics_guided:
    boundary_layer_focus: true
    shear_stress_regions: true
    turbulence_intensity_regions: true

# æ¨¡å‹æ¶æ§‹è¨­å®š - ğŸ”§ ç§»é™¤ scaling wrapper
model:
  type: "fourier_mlp"
  in_dim: 2
  out_dim: 3
  width: 256
  depth: 6
  activation: "tanh"
  
  fourier_m: 48
  fourier_sigma: 3.0
  
  # ğŸ”§ é—œéµï¼šç¦ç”¨ ManualScalingWrapper
  scaling:
    learnable: false  # ç¦ç”¨ wrapper
    input_norm: null
    output_norm: null

# ç‰©ç†è¨­å®š
physics:
  nu: 1.0e-3
  rho: 1.0
  
  channel_flow:
    Re_tau: 1000.0
    Re_bulk: 41980.0
    u_tau: 1.0
    pressure_gradient: -1.0
    
  domain:
    x_range: [0.0, 25.13]
    y_range: [-1.0, 1.0]
    
  boundary_conditions:
    wall_velocity: [0.0, 0.0]
    wall_location: [-1.0, 1.0]
    periodic_x: true
    pressure_driven: true
    mean_pressure_gradient: -1.0

# æå¤±å‡½æ•¸æ¬Šé‡ - ğŸ”§ å•Ÿç”¨ Adaptive Weighting
losses:
  # ğŸ”§ åˆå§‹æ¬Šé‡å¹³è¡¡ï¼ˆGradNorm å°‡å‹•æ…‹èª¿æ•´ï¼‰
  data_weight: 10.0        # é«˜æ¬Šé‡ç›£ç£
  boundary_weight: 10.0     # é«˜æ¬Šé‡é‚Šç•Œ
  
  # PDE æ®˜å·®æ¬Šé‡ï¼ˆåˆå§‹è¼ƒé«˜ï¼Œå…è¨± GradNorm èª¿æ•´ï¼‰
  momentum_x_weight: 10.0   # æå‡è‡³ 10.0
  momentum_y_weight: 10.0   # æå‡è‡³ 10.0
  continuity_weight: 10.0   # æå‡è‡³ 10.0
  
  # Channel Flow ç‰¹æœ‰ç´„æŸ
  wall_constraint_weight: 5.0
  periodicity_weight: 2.0
  pressure_gradient_weight: 1.0
  
  # ğŸ”§ ç§»é™¤ mock prior å¹²æ“¾
  prior_weight: 0.0         # å¾ 0.3 é™ç‚º 0
  source_l1: 1.0e-6
  gradient_penalty: 1.0e-4
  
  # ğŸ”§ å•Ÿç”¨ Adaptive Weighting (GradNorm)
  adaptive_weighting: true   # å¾ false æ”¹ç‚º true
  weight_update_freq: 100    # æ¯ 100 epochs æ›´æ–°æ¬Šé‡
  grad_norm_alpha: 0.12      # GradNorm è¶…åƒæ•¸
  
  # æ™‚é–“å› æœæ¬Šé‡
  causal_weighting: false

# è¨“ç·´è¨­å®š - ğŸ”§ å»¶é•·è‡³ 1000 epochs
training:
  optimizer: "adam"
  lr: 8.0e-4
  weight_decay: 1.0e-5
  lr_scheduler: "cosine"
  
  max_epochs: 1000          # å¾ 500 å¢åŠ è‡³ 1000
  batch_size: 1024
  validation_freq: 50
  checkpoint_freq: 100
  early_stopping: true
  patience: 300             # å¢åŠ è€å¿ƒå€¼ä»¥é…åˆé•·è¨“ç·´
  
  sampling:
    pde_points: 4096
    boundary_points: 1000
    wall_clustering: 0.3
    
  curriculum: true
  curriculum_schedule: "exponential"
  curriculum_stages:
    - epochs: 100           # å»¶é•·ç¬¬ä¸€éšæ®µ
      active_losses: ["boundary", "wall_constraint"]
      sampling_focus: "wall"
    - epochs: 300           # å»¶é•·ç¬¬äºŒéšæ®µ
      active_losses: ["boundary", "wall_constraint", "momentum"]
      sampling_focus: "boundary_layer"
    - epochs: -1
      active_losses: ["all"]
      sampling_focus: "full_domain"

# Ensemble èˆ‡ä¸ç¢ºå®šæ€§é‡åŒ–
ensemble:
  enable: false
  n_models: 8
  seeds: [0, 1, 2, 3, 4, 5, 6, 7]
  uncertainty_quantification: true
  confidence_level: 0.95

# è©•ä¼°è¨­å®š
evaluation:
  grid_resolution: [256, 128]
  
  metrics:
    - "relative_l2"
    - "wall_shear_stress"
    - "velocity_profile"
    - "friction_coefficient"
    - "turbulence_statistics"
    - "pressure_drop"
    - "uncertainty_corr"
    
  thresholds:
    l2_error: 0.15          # æ”¾å¯¬è‡³ 15%ï¼ˆåŸ 10%ï¼‰
    wall_shear_error: 0.05
    velocity_profile_error: 0.08
    rmse_improvement: 0.30
    uq_correlation: 0.6
    
  channel_flow_validation:
    log_law_region: [30, 300]
    von_karman_constant: 0.41
    wake_parameter: 0.55

# æ—¥èªŒèˆ‡å„²å­˜
logging:
  level: "info"
  log_freq: 50            # æ›´é »ç¹çš„æ—¥èªŒï¼ˆå¾ 100 é™ç‚º 50ï¼‰
  save_predictions: true
  save_checkpoints: true
  
  save_velocity_profiles: true
  save_wall_quantities: true
  save_turbulence_fields: true
  
  wandb:
    project: "pinnx-channel-flow-re1000-fix6-k50-adaptive"
    entity: null
    tags: ["pinns", "inverse", "channel_flow", "re1000", "jhtdb", "fix6", "k50", "adaptive", "no_wrapper"]

# é‡ç¾æ€§è¨­å®š
reproducibility:
  deterministic: true
  benchmark: false
  num_workers: 4

# Channel Flow Re1000 å°ˆç”¨é©—è­‰è¨­å®š
validation:
  dns_benchmark: true
  dns_data_path: "./data/jhtdb/channel_flow_re1000/dns_reference"
  
  turbulence_statistics:
    reynolds_stress: true
    turbulent_kinetic_energy: true
    dissipation_rate: true
    
  wall_quantities:
    skin_friction: true
    heat_transfer: false
    pressure_fluctuation: true

# æ•ˆèƒ½å„ªåŒ–è¨­å®š
performance:
  mixed_precision: true
  gradient_checkpointing: false
  vectorized_operations: true
  parallel_sampling: true
  max_gpu_memory_fraction: 0.9
  clear_cache_freq: 1000
