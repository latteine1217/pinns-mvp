# Channel Flow Curriculum Training - 4-Stage Progressive Re_tau
# ğŸ¯ ç›®æ¨™ï¼šå¾ä½é›·è«¾æ•¸é€æ­¥ç™¼å±•åˆ° Re_tau=1000ï¼Œè®“æ¨¡å‹å¾å±¤æµå­¸ç¿’åˆ°æ¹æµ
# ğŸ“š èª²ç¨‹è¨­è¨ˆï¼š
#   Stage 1 (0-1000 epochs): Re_tau=100  (è¿‘ä¼¼å±¤æµï¼Œæ‹‹ç‰©ç·šé€Ÿåº¦å‰–é¢)
#   Stage 2 (1000-2000):     Re_tau=300  (éæ¸¡æ¹æµï¼Œå°æ•¸å¾‹åˆç¾)
#   Stage 3 (2000-3000):     Re_tau=550  (å……åˆ†ç™¼å±•æ¹æµï¼Œå£é¢å¾‹æ˜ç¢º)
#   Stage 4 (3000-4000):     Re_tau=1000 (ç›®æ¨™é«˜é›·è«¾æ•¸ï¼Œå®Œæ•´æ¹æµçµæ§‹)

# åŸºæœ¬å¯¦é©—è¨­å®š
experiment:
  name: "pinnx_channel_flow_curriculum_ic"
  version: "v1.1_4stage_with_initial_condition"
  seed: 42
  device: "auto"
  precision: "float32"
  description: "å››éšæ®µèª²ç¨‹è¨“ç·´ + t=0 åˆå§‹æ¢ä»¶ï¼šRe_tau 100â†’300â†’550â†’1000"

# ğŸ†• Initial Condition é…ç½®ï¼ˆt=0 æ™‚åˆ»æµå ´ç´„æŸï¼‰
initial_condition:
  enabled: true              # å•Ÿç”¨åˆå§‹æ¢ä»¶ç´„æŸ
  use_data: true             # ä½¿ç”¨çœŸå¯¦æ•¸æ“šä½œç‚º IC
  n_points: 256              # IC æ¡æ¨£é»æ•¸
  time: 0.0                  # åˆå§‹æ™‚åˆ»
  # å¦‚æœæœ‰çœŸå¯¦æ•¸æ“šï¼Œå°‡å¾ data/jhtdb/channel_flow_re1000 ä¸­è®€å–

# ğŸ†• Inlet é‚Šç•Œæ¢ä»¶é…ç½®ï¼ˆæŒ‡å°ä¸»æµæ–¹å‘ï¼‰
inlet:
  enabled: true           # å•Ÿç”¨ inlet ç´„æŸ
  n_points: 64            # inlet é‚Šç•Œé»æ•¸é‡
  x_position: -1.0        # inlet ä½ç½®ï¼ˆæ¨™æº–åŒ–åº§æ¨™ï¼Œå·¦é‚Šç•Œï¼‰
  # profile_type åœ¨å„éšæ®µå‹•æ…‹èª¿æ•´

# è³‡æ–™ç›¸é—œè¨­å®š - JHTDB Channel Flow
data:
  source: "jhtdb"
  dataset: "channel"
  
  jhtdb_config:
    enabled: true
    dataset_name: "channel"
    description: "é€šé“æµ (Re_tau=1000)"
    domain:
      x: [0, 25.13]
      y: [-1.0, 1.0]
      z: [0, 9.42]
    resolution:
      x: 2048
      y: 512
      z: 1536
    time_range: [0.0, 26.0]
    dt: 0.0065
    variables: ['u', 'v', 'p']
  
  normalize: true
  cache_dir: "./data/jhtdb/channel_flow_re1000"
  noise_sigma: 0.02
  dropout_prob: 0.10
  
  slice_config:
    plane: "xy"
    z_position: 4.71
    steady_state: true
    time_average_window: [20.0, 26.0]

# æ„Ÿæ¸¬é»é…ç½®
sensors:
  K: 80
  selection_method: "wall_balanced"
  sensor_file: "sensors_K80_wall_balanced.npz"
  
  spatial_coverage: "proportional_layering"
  layer_allocation: [8, 24, 15, 24, 9]
  sampling_method: "u_quantile"

# æ¨¡å‹æ¶æ§‹è¨­å®š
model:
  type: "fourier_mlp"
  in_dim: 2
  out_dim: 3
  width: 256
  depth: 6
  activation: "sine"  # ğŸ”¥ ä½¿ç”¨ SIREN é©é…é«˜é »ç‰¹å¾µ
  
  fourier_m: 48
  fourier_sigma: 3.0
  
  scaling:
    learnable: false
    input_norm:
      x: [0.0, 25.13]
      y: [-1.0, 1.0]
    output_norm:
      u: [0.0, 16.5]
      v: [-0.6, 0.6]
      p: [-85.0, 3.0]

# ç‰©ç†è¨­å®š - ğŸ”¥ Stage 4 çš„æœ€çµ‚ç›®æ¨™åƒæ•¸
physics:
  nu: 1.0e-3
  rho: 1.0
  
  channel_flow:
    Re_tau: 1000.0        # æœ€çµ‚ç›®æ¨™
    Re_bulk: 41980.0
    u_tau: 1.0
    pressure_gradient: -1.0
    
  domain:
    x_range: [0.0, 25.13]
    y_range: [-1.0, 1.0]
    
  boundary_conditions:
    wall_velocity: [0.0, 0.0]
    wall_location: [-1.0, 1.0]
    periodic_x: true
    pressure_driven: true
    mean_pressure_gradient: -1.0

# ğŸš€ğŸš€ğŸš€ èª²ç¨‹è¨“ç·´æ ¸å¿ƒé…ç½®
curriculum:
  enable: true
  mode: "staged"
  total_epochs: 4000
  
  # å››éšæ®µé…ç½®
  stages:
    - name: "Stage1_Laminar"
      epoch_range: [0, 1000]
      description: "è¿‘ä¼¼å±¤æµ Re_tau=100ï¼Œå»ºç«‹åŸºç¤é€Ÿåº¦å‰–é¢"
      
      # ç‰©ç†åƒæ•¸
      Re_tau: 100.0
      nu: 1.0e-2          # é«˜é»åº¦
      pressure_gradient: -0.1
      
      # æ¬Šé‡ç­–ç•¥ï¼šå¼·é‚Šç•Œç´„æŸ + åˆå§‹æ¢ä»¶ + å¼±ç‰©ç†æ–¹ç¨‹
      weights:
        data: 1.0
        wall_constraint: 200.0    # è¶…å¼·å£é¢ç´„æŸ
        periodicity: 100.0
        inlet: 200.0              # ğŸ†• èˆ‡å£é¢ç´„æŸç›¸ç•¶ï¼Œå¼·åˆ¶å»ºç«‹æ­£ç¢ºä¸»æµæ–¹å‘
        initial_condition: 300.0  # ğŸ”¥ è¶…å¼·åˆå§‹æ¢ä»¶ï¼Œå»ºç«‹æ­£ç¢ºåˆå§‹å ´
        momentum_x: 2.0           # å¼±ç‰©ç†æ–¹ç¨‹
        momentum_y: 2.0
        continuity: 5.0
        prior: 0.0
      
      # Inlet é…ç½®ï¼šå±¤æµéšæ®µä½¿ç”¨æ‹‹ç‰©ç·šå‰–é¢
      inlet:
        profile_type: 'parabolic'
        u_max: 6.0                # ä½ Re çš„æœ€å¤§é€Ÿåº¦ï¼ˆå°æ‡‰ Re_tau=100ï¼‰
      
      # æ¡æ¨£ç­–ç•¥
      sampling:
        pde_points: 2048          # è¼ƒå°‘ PDE é»
        boundary_points: 3000     # å¤§é‡é‚Šç•Œé»
      
      # å­¸ç¿’ç‡
      lr: 1.0e-3
      
    - name: "Stage2_Transition"
      epoch_range: [1000, 2000]
      description: "éæ¸¡æ¹æµ Re_tau=300ï¼Œå°æ•¸å¾‹åˆç¾"
      
      Re_tau: 300.0
      nu: 3.33e-3
      pressure_gradient: -0.333
      
      weights:
        data: 1.0
        wall_constraint: 100.0    # é™ä½é‚Šç•Œæ¬Šé‡
        periodicity: 50.0
        inlet: 100.0              # ğŸ†• é€æ­¥é™ä½ï¼Œè®“ç‰©ç†æ–¹ç¨‹åƒèˆ‡æ›´å¤š
        initial_condition: 150.0  # ğŸ”¥ é™ä½ IC æ¬Šé‡ï¼Œè®“æ¨¡å‹å­¸ç¿’æ¼”åŒ–
        momentum_x: 5.0           # æå‡ç‰©ç†æ–¹ç¨‹æ¬Šé‡
        momentum_y: 5.0
        continuity: 10.0
        prior: 0.0
      
      # Inlet é…ç½®ï¼šéæ¸¡éšæ®µä½¿ç”¨å°æ•¸å¾‹
      inlet:
        profile_type: 'log_law'
        u_max: 10.0               # éæ¸¡é›·è«¾æ•¸çš„æœ€å¤§é€Ÿåº¦
      
      sampling:
        pde_points: 3072
        boundary_points: 2500
      
      lr: 8.0e-4
      
    - name: "Stage3_Turbulent"
      epoch_range: [2000, 3000]
      description: "å……åˆ†ç™¼å±•æ¹æµ Re_tau=550ï¼Œå£é¢å¾‹æ˜ç¢º"
      
      Re_tau: 550.0
      nu: 1.82e-3
      pressure_gradient: -0.55
      
      weights:
        data: 1.0
        wall_constraint: 50.0     # ç¹¼çºŒé™ä½
        periodicity: 25.0
        inlet: 50.0               # ğŸ†• ç¹¼çºŒé™ä½ï¼Œç‰©ç†æ–¹ç¨‹ä¸»å°
        initial_condition: 50.0   # ğŸ”¥ IC æ¬Šé‡èˆ‡é‚Šç•Œå¹³è¡¡
        momentum_x: 10.0          # ç‰©ç†æ–¹ç¨‹ä¸»å°
        momentum_y: 10.0
        continuity: 20.0
        prior: 0.0
      
      # Inlet é…ç½®ï¼šæ¹æµéšæ®µä½¿ç”¨å°æ•¸å¾‹
      inlet:
        profile_type: 'log_law'
        u_max: 13.5               # æ¹æµé›·è«¾æ•¸çš„æœ€å¤§é€Ÿåº¦
      
      sampling:
        pde_points: 4096
        boundary_points: 2000
      
      lr: 5.0e-4
      
    - name: "Stage4_HighRe"
      epoch_range: [3000, 4000]
      description: "ç›®æ¨™é«˜é›·è«¾æ•¸ Re_tau=1000ï¼Œå®Œæ•´æ¹æµ"
      
      Re_tau: 1000.0
      nu: 1.0e-3
      pressure_gradient: -1.0
      
      weights:
        data: 1.0
        wall_constraint: 100.0    # ğŸ”¥ å¾®èª¿ï¼šé‡æ–°å¹³è¡¡é‚Šç•Œèˆ‡ç‰©ç†
        periodicity: 50.0
        inlet: 100.0              # ğŸ†• èˆ‡å£é¢ç´„æŸå¹³è¡¡ï¼Œç©©å®šé«˜ Re æ”¶æ–‚
        initial_condition: 100.0  # ğŸ”¥ ä¿æŒ IC ç´„æŸï¼Œç©©å®šé«˜ Re
        momentum_x: 10.0
        momentum_y: 10.0
        continuity: 20.0
        prior: 0.0
      
      # Inlet é…ç½®ï¼šç›®æ¨™é«˜é›·è«¾æ•¸ï¼Œä½¿ç”¨æ¹æµå‰–é¢
      inlet:
        profile_type: 'turbulent'  # 1/7 æ¬¡æ–¹å¾‹ï¼Œå……åˆ†ç™¼å±•æ¹æµ
        u_max: 16.5                # ç›®æ¨™ Re_tau=1000 çš„æœ€å¤§é€Ÿåº¦
      
      sampling:
        pde_points: 4096
        boundary_points: 2000
      
      lr: 3.0e-4              # æœ€ä½å­¸ç¿’ç‡ï¼Œç²¾ç´°èª¿æ•´

# æå¤±å‡½æ•¸åŸºç¤é…ç½®ï¼ˆæœƒè¢« curriculum.stages è¦†è“‹ï¼‰
losses:
  # é€™äº›å€¼æœƒè¢«èª²ç¨‹è¨“ç·´è¦†è“‹ï¼Œåƒ…ä½œç‚ºå¾Œå‚™
  data_weight: 1.0
  wall_constraint_weight: 100.0
  periodicity_weight: 50.0
  inlet_weight: 100.0           # ğŸ†• Inlet æ¬Šé‡ï¼ˆèˆ‡å£é¢ç´„æŸç›¸ç•¶ï¼‰
  initial_condition_weight: 100.0  # ğŸ”¥ Initial condition æ¬Šé‡
  momentum_x_weight: 10.0
  momentum_y_weight: 10.0
  continuity_weight: 20.0
  prior_weight: 0.0
  
  source_l1: 1.0e-6
  gradient_penalty: 1.0e-4
  
  # è‡ªé©æ‡‰æ¬Šé‡ï¼ˆæ¯éšæ®µå…§éƒ¨å¾®èª¿ï¼‰
  adaptive_weighting: true
  weight_update_freq: 50
  grad_norm_alpha: 0.15
  
  causal_weighting: false

# è¨“ç·´è¨­å®š
training:
  optimizer: "adam"
  lr: 1.0e-3              # åˆå§‹å­¸ç¿’ç‡ï¼ˆæœƒè¢«èª²ç¨‹è¦†è“‹ï¼‰
  weight_decay: 1.0e-5
  lr_scheduler: "cosine"  # æ¯éšæ®µå…§ä½¿ç”¨ cosine decay
  
  max_epochs: 4000        # ç¸½è¨“ç·´è¼ªæ•¸
  batch_size: 1024
  validation_freq: 100
  checkpoint_freq: 100
  early_stopping: false
  patience: 500
  
  sampling:
    pde_points: 4096      # é è¨­å€¼ï¼ˆæœƒè¢«èª²ç¨‹è¦†è“‹ï¼‰
    boundary_points: 2000
    wall_clustering: 0.1
    center_enhancement: 0.4
    high_velocity_sampling: 0.3

# Ensemble èˆ‡ä¸ç¢ºå®šæ€§é‡åŒ–
ensemble:
  enable: false
  n_models: 8
  seeds: [0, 1, 2, 3, 4, 5, 6, 7]
  uncertainty_quantification: true
  confidence_level: 0.95

# è©•ä¼°è¨­å®š
evaluation:
  grid_resolution: [256, 128]
  
  metrics:
    - "relative_l2"
    - "wall_shear_stress"
    - "velocity_profile"
    - "friction_coefficient"
    - "turbulence_statistics"
    - "pressure_drop"
    - "mass_conservation"
    
  thresholds:
    l2_error: 0.15
    wall_shear_error: 0.10
    velocity_profile_error: 0.08
    rmse_improvement: 0.30
    mass_conservation_error: 0.1
    
  channel_flow_validation:
    log_law_region: [30, 300]
    von_karman_constant: 0.41
    wake_parameter: 0.55

# æ—¥èªŒèˆ‡å„²å­˜
logging:
  level: "info"
  log_freq: 50
  save_predictions: true
  save_checkpoints: true
  
  save_velocity_profiles: true
  save_wall_quantities: true
  save_turbulence_fields: true
  
  monitor_conservation: true
  conservation_check_freq: 25
  
  # ğŸ”¥ èª²ç¨‹è¨“ç·´å°ˆç”¨ï¼šæ¯éšæ®µçµæŸæ™‚ä¿å­˜æª¢æŸ¥é»
  save_stage_checkpoints: true
  stage_checkpoint_dir: "./checkpoints/curriculum"
  
  wandb:
    project: "pinnx-channel-flow-curriculum"
    entity: null
    tags: ["pinns", "curriculum", "channel_flow", "4stage", "progressive_re"]

# é‡ç¾æ€§è¨­å®š
reproducibility:
  deterministic: true
  benchmark: false
  num_workers: 4

# Channel Flow Re1000 å°ˆç”¨é©—è­‰è¨­å®š
validation:
  dns_benchmark: true
  dns_data_path: "./data/jhtdb/channel_flow_re1000/dns_reference"
  
  turbulence_statistics:
    reynolds_stress: true
    turbulent_kinetic_energy: true
    dissipation_rate: true
    
  wall_quantities:
    skin_friction: true
    heat_transfer: false
    pressure_fluctuation: true

# æ•ˆèƒ½å„ªåŒ–è¨­å®š
performance:
  mixed_precision: false  # ğŸ”¥ èª²ç¨‹è¨“ç·´åˆæœŸä¸ä½¿ç”¨æ··åˆç²¾åº¦
  gradient_checkpointing: false
  vectorized_operations: true
  parallel_sampling: true
  max_gpu_memory_fraction: 0.9
  clear_cache_freq: 1000
