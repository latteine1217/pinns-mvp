# ğŸ¯ æ„Ÿæ¸¬é»ç­–ç•¥æ¶ˆèå¯¦é©— - Stratified æ”¹é€²ç‰ˆ
# ç›®æ¨™ï¼šé©—è­‰ç‰©ç†å…ˆé©—å¼•å°çš„åˆ†å±¤æ¡æ¨£ï¼ˆä¸­å¿ƒå€è¦†è“‹ç‡=32%ï¼‰
# å°ç…§çµ„ï¼šèˆ‡ ablation_sensor_qr_K50 å°æ¯”

# =============================================================================
# åŸºæœ¬å¯¦é©—è¨­å®š
# =============================================================================
experiment:
  name: "ablation_sensor_stratified_K50"
  version: "v1.0"
  seed: 42
  device: "auto"
  precision: "float32"
  description: "Improved stratified sensor selection (K=50, core coverage=32%)"

# =============================================================================
# é‡ç¾æ€§è¨­å®š
# =============================================================================
reproducibility:
  deterministic: true
  benchmark: false
  num_workers: 4

# =============================================================================
# è³‡æ–™é…ç½®ï¼ˆ2D åˆ‡ç‰‡ï¼‰
# =============================================================================
data:
  source: "jhtdb"
  dataset: "channel"
  
  jhtdb_config:
    enabled: true
    dataset_name: "channel"
    description: "é€šé“æµ (Re_tau=1000) - 2D åˆ‡ç‰‡"
    domain:
      x: [0, 25.13]
      y: [-1.0, 1.0]
      z: [0, 9.42]
    resolution:
      x: 2048
      y: 512
      z: 1536
    time_range: [0.0, 26.0]
    dt: 0.0065
    variables: ['u', 'v', 'w', 'p']
  
  normalize: true
  cache_dir: "./data/jhtdb/channel_flow_re1000"

# =============================================================================
# ğŸ”‘ æ¨™æº–åŒ–é…ç½®
# =============================================================================
normalization:
  type: 'training_data_norm'
  params:
    # âœ… ä½¿ç”¨å®Œæ•´å ´çµ±è¨ˆé‡ï¼ˆxy_pos4.558_128x64.npzï¼‰
    u_mean: 9.841616
    u_std: 4.693586
    v_mean: -0.001289
    v_std: 0.131136
    w_mean: 0.003443
    w_std: 4.756861  # ğŸ”‘ ä¿®å¾© w_stdï¼ˆåŸç¡¬ç·¨ç¢¼ 3.865 â†’ æ­£ç¢ºå€¼ 4.757ï¼‰
    p_mean: -43.053123
    p_std: 32.005985
    fields: ['u', 'v', 'w', 'p', 'x', 'y', 'z']
    epsilon: 1.0e-8
  noise_sigma: 0.01
  dropout_prob: 0.05
  
  # 2D åˆ‡ç‰‡é…ç½®
  slice_config:
    plane: "xy"
    z_position: 4.71
    steady_state: true
    time_average_window: [20.0, 26.0]

# =============================================================================
# â­ æ„Ÿæ¸¬é»é…ç½®ï¼ˆæ ¸å¿ƒå·®ç•°ï¼‰
# =============================================================================
sensors:
  K: 50
  selection_method: "stratified"  # ğŸŸ¢ åˆ†å±¤æ¡æ¨£ï¼ˆå£é¢ 34%, å°æ•¸å¾‹ 34%, ä¸­å¿ƒå€ 32%ï¼‰
  sensor_file: "sensors_K50_stratified.npz"  # ç›¸å°æ–¼ cache_dir çš„æª”å
  spatial_coverage: "physics_aware"

# =============================================================================
# æ¨¡å‹æ¶æ§‹
# =============================================================================
model:
  type: "enhanced_fourier_mlp"
  in_dim: 3
  out_dim: 4
  width: 128
  depth: 4
  activation: "sine"
  fourier_m: 16           # â­ æå‡è‡³ model å±¤ç´šï¼ˆèˆ‡æª¢æŸ¥é»åŒ¹é…ï¼‰
  fourier_sigma: 5.0      # â­ æå‡è‡³ model å±¤ç´š
  
  fourier_features:
    type: "axis_selective"
    axes_config: {x: [1, 2], y: [], z: [1, 2]}
    full_axes_config: {x: [1, 2, 4], y: [], z: [1, 2, 4]}
    domain_lengths: {x: 25.13, y: 2.0, z: 9.42}
    fourier_m: 16
    fourier_sigma: 5.0
  
  scaling:
    learnable: true
    input_norm: "channel_flow"
    output_norm: "friction_velocity"
    friction_velocity: 0.04997
    channel_half_height: 1.0
    viscous_length: 1.0e-3

# =============================================================================
# ç‰©ç†è¨­å®š
# =============================================================================
physics:
  type: "vs_pinn_channel_flow"
  nu: 5.0e-5
  rho: 1.0
  
  vs_pinn:
    use_gradient_checkpointing: false
    scaling_factors:
      N_x: 2.0
      N_y: 12.0
      N_z: 2.0
    
    loss_config:
      warmup_epochs: 5
    
    boundary_config:
      boundary_band_width: 5.0e-3
    
    enable_rans: false
  
  channel_flow:
    Re_tau: 1000.0
    Re_bulk: 39998.0
    u_tau: 0.04997
    pressure_gradient: 0.0025
    
  domain:
    x_range: [0.0, 25.13]
    y_range: [-1.0, 1.0]
    z_range: [0.0, 9.42]
    
  boundary_conditions:
    wall_velocity: [0.0, 0.0, 0.0]
    wall_location: [-1.0, 1.0]
    periodic_x: true
    periodic_z: true
    pressure_driven: true
    mean_pressure_gradient: 0.0025

# =============================================================================
# æå¤±å‡½æ•¸æ¬Šé‡
# =============================================================================
losses:
  data_weight: 5.0
  boundary_weight: 5.0
  
  momentum_x_weight: 5.0
  momentum_y_weight: 5.0
  momentum_z_weight: 5.0
  continuity_weight: 5.0
  
  wall_constraint_weight: 10.0
  periodicity_weight: 2.0
  pressure_gradient_weight: 1.0
  
  prior_weight: 0.1
  source_l1: 1.0e-7
  gradient_penalty: 1.0e-5
  
  adaptive_weighting: false
  causal_weighting: false

# =============================================================================
# è¨“ç·´è¨­å®š
# =============================================================================
training:
  optimizer: "adam"
  lr: 1.0e-3
  weight_decay: 1.0e-5
  
  lr_scheduler:
    type: "warmup_cosine"
    min_lr: 1.0e-5
    warmup_epochs: 10
    T_max: 500
  
  epochs: 500
  max_epochs: 500
  batch_size: 512
  validation_freq: 50
  checkpoint_freq: 100
  log_interval: 10
  
  early_stopping:
    enabled: true
    patience: 100
    min_delta: 1.0e-6
  
  sampling:
    pde_points: 1024
    boundary_points: 500
    wall_clustering: 0.2
  
  gradient_clip: 1.0
  
  amp:
    enabled: false

curriculum:
  enable: false

ensemble:
  enable: false

# =============================================================================
# è©•ä¼°è¨­å®š
# =============================================================================
evaluation:
  grid_resolution: [64, 32, 32]
  
  metrics:
    - "relative_l2"
    - "wall_shear_stress"
    - "mass_conservation"
    - "mean_velocity_profile"
    - "centerline_velocity_error"  # â­ é‡é»æŒ‡æ¨™
  
  thresholds:
    l2_error: 0.50
    mass_conservation_error: 1.0e-2
    wall_shear_stress_error: 0.50
    mean_profile_correlation: 0.70
    centerline_velocity_error: 0.20  # ğŸŸ¢ é æœŸè¼ƒå°èª¤å·®ï¼ˆvs. QR=0.30ï¼‰

# =============================================================================
# æ—¥èªŒèˆ‡å„²å­˜
# =============================================================================
logging:
  level: "info"
  log_freq: 10
  save_predictions: true
  tensorboard: true
  wandb: false

output:
  checkpoint_dir: "./checkpoints/ablation_sensor_stratified_K50"
  results_dir: "./results/ablation_sensor_stratified_K50"
  visualization_dir: "./results/ablation_sensor_stratified_K50/visualizations"

# =============================================================================
# é©—æ”¶æ¨™æº–
# =============================================================================
test_acceptance:
  stability:
    - no_nan_inf: true
    - loss_finite: true
    - gradient_stable: true
  
  performance:
    - u_l2_error_target: 0.50
    - loss_converged: true
    - pde_loss_ratio_min: 0.10
