# ========================================
# Weighting æ¶æ§‹æ•´åˆæ¸¬è©¦é…ç½®
# ========================================
# ç”¨é€”: é©—è­‰æ–° weighting.py èˆ‡è¨“ç·´æµç¨‹çš„æ•´åˆ
# è¦æ¨¡: 10 epochs å¿«é€Ÿæ¸¬è©¦

experiment:
  name: "test_weighting_integration"
  version: "v1.0"
  seed: 42
  device: "auto"
  precision: "float32"
  description: "Weighting æ¶æ§‹æ•´åˆæ¸¬è©¦ (10 epochs)"

# è³‡æ–™é…ç½®ï¼ˆæœ€å°è¦æ¨¡ï¼‰
data:
  type: "jhtdb_channel"
  dataset: "channel"
  re_tau: 1000
  
  data_dir: "./data/jhtdb"
  lowfi_dir: "./data/lowfi"
  
  # JHTDB é…ç½®
  jhtdb_config:
    enabled: true
    dataset: "channel"
    re_tau: 1000
    time_step: 0.0
    use_cache: true
    
    domain:
      x: [0.0, 25.132741228718345]
      y: [0.0, 2.0]
      z: [0.0, 9.42477796076938]
    
    Re_tau: 1000.0
    nu: 5.0e-5
    u_tau: 0.04997
  
  domain:
    x_min: 0.0
    x_max: 25.132741228718345
    y_min: 0.0
    y_max: 2.0
    z_min: 0.0
    z_max: 9.42477796076938
  
  # æœ€å°é…ç½®
  num_sensors: 16
  sensor_type: "qr_pivot"
  sensor_noise: 0.01
  
  num_collocation: 512
  num_boundary: 64
  num_initial: 32

# æ„Ÿæ¸¬é»é…ç½®
sensors:
  K: 16
  selection_method: "qr_pivot"
  spatial_coverage: "optimal"

# æ¨¡å‹é…ç½®ï¼ˆæœ€å°è¦æ¨¡ï¼‰
model:
  type: "enhanced_fourier_mlp"
  
  in_dim: 3
  out_dim: 4
  depth: 3
  width: 128
  
  activation: "swish"
  
  use_fourier: true
  fourier_m: 16
  fourier_sigma: 2.0
  fourier_multiscale: false
  trainable_fourier: false
  
  use_rwf: false
  use_residual: false
  use_layer_norm: false
  dropout: 0.0

# è¨“ç·´é…ç½®ï¼ˆ10 epochs æ¸¬è©¦ï¼‰
training:
  epochs: 10
  batch_size: 512
  
  optimizer:
    type: "adam"
    lr: 1.0e-3
    betas: [0.9, 0.999]
    weight_decay: 0.0
  
  scheduler:
    type: "step"
    step_size: 5
    gamma: 0.9
  
  sampling:
    pde_points: 512
    boundary_points: 64
    wall_clustering: 0.3
  
  validation_freq: 2
  checkpoint_freq: 5
  log_interval: 1

# ğŸ“Š æå¤±æ¬Šé‡é…ç½®ï¼ˆæ¸¬è©¦æ–°æ¶æ§‹ï¼‰
losses:
  # åŸºç¤æ¬Šé‡
  data_weight: 100.0
  pde_weight: 1.0
  bc_weight: 10.0
  wall_constraint_weight: 10.0
  prior_weight: 0.1  # ä½ä¿çœŸå…ˆé©—æ¬Šé‡
  
  # ç´°é …æ¬Šé‡ï¼ˆæ¸¬è©¦ç´°ç²’åº¦é…ç½®ï¼‰
  momentum_x_weight: 1.0
  momentum_y_weight: 1.0
  momentum_z_weight: 1.0
  continuity_weight: 1.0
  
  # âœ… GradNorm è‡ªé©æ‡‰æ¬Šé‡ï¼ˆæ–°æ¶æ§‹æ¸¬è©¦é‡é»ï¼‰
  adaptive_weighting: true
  grad_norm_alpha: 0.12
  weight_update_freq: 5  # æ¯ 5 æ­¥æ›´æ–°ä¸€æ¬¡ï¼ˆå¿«é€Ÿè§€å¯Ÿï¼‰
  grad_norm_min_weight: 0.1
  grad_norm_max_weight: 10.0
  
  # æŒ‡å®šè¦è‡ªé©æ‡‰èª¿æ•´çš„æå¤±é …
  adaptive_loss_terms:
    - "data"
    - "momentum_x"
    - "momentum_y"
    - "continuity"
    - "wall_constraint"
  
  # âœ… å› æœæ¬Šé‡ï¼ˆæ¸¬è©¦èˆ‡ GradNorm å…±å­˜ï¼‰
  causal_weighting: true
  causal_eps: 1.0
  
  # âŒ éšæ®µå¼æ¬Šé‡ï¼ˆèˆ‡ GradNorm äº’æ–¥ï¼Œæ¸¬è©¦æ™‚ç¦ç”¨ï¼‰
  staged_weights:
    enable: false

# ç‰©ç†é…ç½®
physics:
  type: "vs_pinn_channel_flow"
  nu: 5.0e-5
  re_tau: 1000
  u_tau: 0.04997
  
  domain:
    x_min: 0.0
    x_max: 25.132741228718345
    y_min: 0.0
    y_max: 2.0
    z_min: 0.0
    z_max: 9.42477796076938
  
  scaling:
    use_scaling: true
    N_x: 0.33
    N_y: 1.00
    N_z: 0.25

# è¼¸å‡ºé…ç½®
output:
  checkpoint_dir: "./checkpoints/test_weighting_integration"
  results_dir: "./results/test_weighting_integration"
  visualization_dir: "./results/test_weighting_integration/visualizations"
  save_predictions: false
  save_frequency: 5

# æ—¥èªŒé…ç½®
logging:
  level: "info"
  log_freq: 1  # æ¯å€‹ epoch éƒ½è¨˜éŒ„
  tensorboard: false
  wandb: false
  
  metrics:
    - "total_loss"
    - "data_loss"
    - "pde_loss"
    - "wall_loss"
    - "learning_rate"

# æ—©åœé…ç½®ï¼ˆç¦ç”¨ï¼‰
early_stopping:
  enabled: false

# å¯é‡ç¾æ€§é…ç½®
reproducibility:
  deterministic: true
  benchmark: false
