# âš¡ 2D å¿«é€ŸåŸºæº–æ¸¬è©¦æ¨¡æ¿
# ç”¨é€”ï¼šå¿«é€Ÿé©—è­‰æƒ³æ³•ã€èª¿è©¦ä»£ç¢¼ã€åˆæ­¥å¯è¡Œæ€§æ¸¬è©¦
# é æœŸæ™‚é–“ï¼š5-10 åˆ†é˜ï¼ˆ50-100 epochsï¼‰
# ç›®æ¨™ï¼šç©©å®šæ”¶æ–‚ã€ç„¡ NaNã€åŸºæœ¬ç‰©ç†ä¸€è‡´æ€§

# =============================================================================
# åŸºæœ¬å¯¦é©—è¨­å®š
# =============================================================================
experiment:
  name: "2d_quick_baseline_test"  # âš ï¸ ä¿®æ”¹ç‚ºä½ çš„å¯¦é©—åç¨±
  version: "v1.0"
  seed: 42
  device: "auto"  # auto/cpu/cuda
  precision: "float32"
  description: "Quick baseline test for 2D channel flow"

# =============================================================================
# é‡ç¾æ€§è¨­å®š
# =============================================================================
reproducibility:
  deterministic: true
  benchmark: false
  num_workers: 4

# =============================================================================
# è³‡æ–™é…ç½®ï¼ˆ2D åˆ‡ç‰‡ï¼‰
# =============================================================================
data:
  source: "jhtdb"
  dataset: "channel"
  
  jhtdb_config:
    enabled: true
    dataset_name: "channel"
    description: "é€šé“æµ (Re_tau=1000) - 2D åˆ‡ç‰‡"
    domain:
      x: [0, 25.13]
      y: [-1.0, 1.0]
      z: [0, 9.42]
    resolution:
      x: 2048
      y: 512
      z: 1536
    time_range: [0.0, 26.0]
    dt: 0.0065
    variables: ['u', 'v', 'w', 'p']
  
  normalize: true
  cache_dir: "./data/jhtdb/channel_flow_re1000"

# è³‡æ–™æ¨™æº–åŒ–é…ç½®
normalization:
  type: 'training_data_norm'
  params: {}
  noise_sigma: 0.01  # å°å™ªè²ï¼ˆå¿«é€Ÿæ¸¬è©¦ï¼‰
  dropout_prob: 0.05  # å°éºå¤±ç‡
  
  # 2D åˆ‡ç‰‡é…ç½®
  slice_config:
    plane: "xy"  # ä¸»è¦å‰ªåˆ‡å¹³é¢
    z_position: 4.71  # ä¸­å¿ƒä½ç½®
    steady_state: true
    time_average_window: [20.0, 26.0]

# =============================================================================
# æ„Ÿæ¸¬é»é…ç½®ï¼ˆç¨€ç–æ¡æ¨£ï¼‰
# =============================================================================
sensors:
  K: 50  # å°‘é‡æ„Ÿæ¸¬é»ï¼ˆå¿«é€Ÿæ¸¬è©¦ï¼‰
  selection_method: "qr_pivot"
  spatial_coverage: "optimal"

# =============================================================================
# æ¨¡å‹æ¶æ§‹ï¼ˆè¼•é‡ç´šï¼‰
# =============================================================================
model:
  type: "enhanced_fourier_mlp"
  in_dim: 3  # x, y, z (2D åˆ‡ç‰‡ä»éœ€ 3D åº§æ¨™)
  out_dim: 4  # u, v, w, p
  width: 128  # è¼ƒå°ç¶²è·¯ï¼ˆå¿«é€Ÿï¼‰
  depth: 4    # è¼ƒæ·ºï¼ˆå¿«é€Ÿï¼‰
  activation: "sine"
  
  # Fourier ç‰¹å¾µï¼ˆå•Ÿç”¨ä½†ç°¡åŒ–ï¼‰
  fourier_features:
    type: "axis_selective"
    axes_config: {x: [1, 2], y: [], z: [1, 2]}  # åŸºæœ¬é »ç‡
    full_axes_config: {x: [1, 2, 4], y: [], z: [1, 2, 4]}  # æ¸›å°‘é«˜é »
    domain_lengths: {x: 25.13, y: 2.0, z: 9.42}
    fourier_m: 16  # æ¸›å°‘ç‰¹å¾µæ•¸
    fourier_sigma: 5.0
  
  # VS-PINN ç¸®æ”¾
  scaling:
    learnable: true
    input_norm: "channel_flow"
    output_norm: "friction_velocity"
    friction_velocity: 0.04997
    channel_half_height: 1.0
    viscous_length: 1.0e-3

# =============================================================================
# ç‰©ç†è¨­å®š
# =============================================================================
physics:
  type: "vs_pinn_channel_flow"
  nu: 5.0e-5
  rho: 1.0
  
  vs_pinn:
    scaling_factors:
      N_x: 2.0
      N_y: 12.0
      N_z: 2.0
    
    loss_config:
      disable_extra_pde_division: true
      warmup_epochs: 5
    
    boundary_config:
      boundary_band_width: 5.0e-3
    
    enable_rans: false  # åŸºæº–æ¸¬è©¦ä¸ä½¿ç”¨ RANS
  
  channel_flow:
    Re_tau: 1000.0
    Re_bulk: 39998.0
    u_tau: 0.04997
    pressure_gradient: 0.0025
    
  domain:
    x_range: [0.0, 25.13]
    y_range: [-1.0, 1.0]
    z_range: [0.0, 9.42]
    
  boundary_conditions:
    wall_velocity: [0.0, 0.0, 0.0]
    wall_location: [-1.0, 1.0]
    periodic_x: true
    periodic_z: true
    pressure_driven: true
    mean_pressure_gradient: 0.0025

# =============================================================================
# æå¤±å‡½æ•¸æ¬Šé‡ï¼ˆå¹³è¡¡é…ç½®ï¼‰
# =============================================================================
losses:
  # è³‡æ–™èˆ‡é‚Šç•Œ
  data_weight: 5.0
  boundary_weight: 5.0
  
  # PDE é …ï¼ˆå¹³è¡¡ï¼‰
  momentum_x_weight: 5.0
  momentum_y_weight: 5.0
  momentum_z_weight: 5.0
  continuity_weight: 5.0
  
  # ç´„æŸ
  wall_constraint_weight: 10.0
  periodicity_weight: 2.0
  pressure_gradient_weight: 1.0
  
  # æ­£å‰‡åŒ–ï¼ˆè¼•é‡ï¼‰
  prior_weight: 0.1
  source_l1: 1.0e-7
  gradient_penalty: 1.0e-5
  
  # âš ï¸ å¿«é€Ÿæ¸¬è©¦ï¼šé—œé–‰è‡ªé©æ‡‰æ¬Šé‡ï¼ˆæ¸›å°‘è®Šæ•¸ï¼‰
  adaptive_weighting: false
  causal_weighting: false

# =============================================================================
# è¨“ç·´è¨­å®šï¼ˆå¿«é€Ÿæ¨¡å¼ï¼‰
# =============================================================================
training:
  optimizer: "adam"  # åƒ… Adamï¼ˆå¿«é€Ÿï¼‰
  lr: 1.0e-3
  weight_decay: 1.0e-5
  
  lr_scheduler:
    type: "warmup_cosine"
    min_lr: 1.0e-5
    warmup_epochs: 10
    T_max: 100
  
  epochs: 100  # å¿«é€Ÿæ¸¬è©¦
  max_epochs: 100
  batch_size: 512  # è¼ƒå°æ‰¹æ¬¡ï¼ˆå¿«é€Ÿï¼‰
  validation_freq: 25
  checkpoint_freq: 50
  log_interval: 10
  
  early_stopping:
    enabled: true
    patience: 50
    min_delta: 1.0e-6
  
  # æ¡æ¨£é…ç½®ï¼ˆè¼ƒå°‘é»ï¼‰
  sampling:
    pde_points: 1024  # æ¸›å°‘ç¢°æ’é»
    boundary_points: 500
    wall_clustering: 0.2
  
  gradient_clip: 1.0
  
  # æ··åˆç²¾åº¦è¨“ç·´ï¼ˆAMPï¼‰
  amp:
    enabled: false  # âš ï¸ å¿«é€Ÿæ¸¬è©¦å»ºè­°é—œé–‰ï¼ˆæ¸›å°‘è®Šæ•¸ï¼‰
    # èªªæ˜ï¼š
    #   - å•Ÿç”¨å¾Œå¯ç¯€çœ 30-50% GPU è¨˜æ†¶é«”
    #   - âš ï¸ åƒ…æ”¯æ´ CUDA è¨­å‚™ï¼ˆMPS ä¸æ”¯æ´ GradScalerï¼‰
    #   - éœ€ä½¿ç”¨ Adam å„ªåŒ–å™¨
    #   - å¿«é€Ÿæ¸¬è©¦å»ºè­°é—œé–‰ä»¥ç°¡åŒ–é™¤éŒ¯
    #   - ç”Ÿç”¢è¨“ç·´å»ºè­°é–‹å•Ÿä»¥æå‡æ•ˆèƒ½

# âš ï¸ é—œé–‰èª²ç¨‹å­¸ç¿’ï¼ˆç°¡åŒ–æµç¨‹ï¼‰
curriculum:
  enable: false

# âš ï¸ é—œé–‰ Ensembleï¼ˆå¿«é€Ÿæ¸¬è©¦ï¼‰
ensemble:
  enable: false

# =============================================================================
# è©•ä¼°è¨­å®š
# =============================================================================
evaluation:
  grid_resolution: [64, 32, 32]  # ä½è§£æåº¦è©•ä¼°
  
  metrics:
    - "relative_l2"
    - "wall_shear_stress"
    - "mass_conservation"
    - "mean_velocity_profile"
  
  # æ”¾å¯¬é–€æª»ï¼ˆå¿«é€Ÿæ¸¬è©¦ï¼‰
  thresholds:
    l2_error: 0.50  # å…è¨±è¼ƒå¤§èª¤å·®
    mass_conservation_error: 1.0e-2
    wall_shear_stress_error: 0.50
    mean_profile_correlation: 0.70

# =============================================================================
# æ—¥èªŒèˆ‡å„²å­˜
# =============================================================================
logging:
  level: "info"
  log_freq: 10
  save_predictions: true
  tensorboard: true
  wandb: false

output:
  checkpoint_dir: "./checkpoints/2d_quick_baseline_test"
  results_dir: "./results/2d_quick_baseline_test"
  visualization_dir: "./results/2d_quick_baseline_test/visualizations"

# =============================================================================
# é©—æ”¶æ¨™æº–ï¼ˆå¿«é€Ÿæ¸¬è©¦ï¼‰
# =============================================================================
test_acceptance:
  stability:
    - no_nan_inf: true
    - loss_finite: true
    - gradient_stable: true
  
  performance:
    - u_l2_error_target: 0.50  # æ”¾å¯¬è‡³ 50%
    - loss_converged: true
    - pde_loss_ratio_min: 0.10  # è‡³å°‘ 10% PDE è²¢ç»

# =============================================================================
# ä½¿ç”¨èªªæ˜
# =============================================================================
usage_notes: |
  ğŸ¯ ç”¨é€”ï¼š
    - å¿«é€Ÿé©—è­‰æ–°æƒ³æ³•ï¼ˆ5-10 åˆ†é˜ï¼‰
    - èª¿è©¦ä»£ç¢¼éŒ¯èª¤
    - ç¢ºèªè³‡æ–™è¼‰å…¥æ­£ç¢º
    - åˆæ­¥å¯è¡Œæ€§æ¸¬è©¦
  
  âš™ï¸ é…ç½®ç‰¹é»ï¼š
    - K=50ï¼ˆæœ€å°‘æ„Ÿæ¸¬é»ï¼‰
    - epochs=100ï¼ˆå¿«é€Ÿæ”¶æ–‚ï¼‰
    - è¼•é‡ç¶²è·¯ï¼ˆ128Ã—4ï¼‰
    - é—œé–‰è‡ªé©æ‡‰/èª²ç¨‹å­¸ç¿’
    - é—œé–‰ RANS prior
  
  âœ… æˆåŠŸæ¨™æº–ï¼š
    1. ç„¡ NaN/Infï¼ˆç©©å®šæ€§ï¼‰
    2. Loss æŒçºŒä¸‹é™ï¼ˆæ”¶æ–‚æ€§ï¼‰
    3. L2 < 50%ï¼ˆåŸºæœ¬ç²¾åº¦ï¼‰
    4. PDE ratio > 10%ï¼ˆç‰©ç†åƒèˆ‡ï¼‰
  
  ğŸš€ ä½¿ç”¨ç¯„ä¾‹ï¼š
    python scripts/train.py --cfg configs/templates/2d_quick_baseline.yml
  
  ğŸ“Š é æœŸçµæœï¼š
    - è¨“ç·´æ™‚é–“ï¼š5-10 åˆ†é˜ï¼ˆGPUï¼‰
    - æœ€çµ‚ L2ï¼š30-50%
    - PDE ratioï¼š10-20%
  
  âš ï¸ é™åˆ¶ï¼š
    - ä¸é©åˆç”Ÿç”¢ç´šè¨“ç·´
    - ç²¾åº¦è¼ƒä½ï¼ˆåƒ…ä¾›é©—è­‰ï¼‰
    - ä¸åŒ…å«å®Œæ•´ç‰©ç†é©—è­‰
