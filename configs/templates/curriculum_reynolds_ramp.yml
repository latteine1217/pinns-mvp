# ğŸ“ Reynolds æ•¸éå¢ Curriculum Learning æ¨¡æ¿
# ç­–ç•¥ï¼šRe_b: 100 â†’ 1000 é€æ­¥æå‡ï¼Œé…åˆ Fourier Ïƒ=2-5 å¼·åŒ–å£é¢é«˜é »
# ç›®çš„ï¼šç©©å®šæ”¶æ–‚ã€é¿å…é«˜ Re æ•¸ç›´æ¥è¨“ç·´çš„æ•¸å€¼ä¸ç©©å®š
# é æœŸæ™‚é–“ï¼š2-4 å°æ™‚ï¼ˆ3000-5000 epochsï¼Œ3-4 éšæ®µï¼‰

# =============================================================================
# åŸºæœ¬å¯¦é©—è¨­å®š
# =============================================================================
experiment:
  name: "curriculum_reynolds_ramp_v1"  # âš ï¸ ä¿®æ”¹ç‚ºä½ çš„å¯¦é©—åç¨±
  version: "v1.0"
  seed: 42
  device: "auto"
  precision: "float32"
  description: "Reynolds number curriculum: Re_b 100â†’1000 with Fourier sigma=2-5"

# =============================================================================
# é‡ç¾æ€§è¨­å®š
# =============================================================================
reproducibility:
  deterministic: true
  benchmark: false
  num_workers: 4

# =============================================================================
# è³‡æ–™é…ç½®ï¼ˆ3D Channel Flowï¼‰
# =============================================================================
data:
  source: "jhtdb"
  dataset: "channel"

  jhtdb_config:
    enabled: true
    dataset_name: "channel"
    description: "é€šé“æµ (Re_tau=1000) - Reynolds Curriculum"
    domain:
      x: [0, 25.13]
      y: [-1.0, 1.0]
      z: [0, 9.42]
    resolution:
      x: 2048
      y: 512
      z: 1536
    time_range: [0.0, 26.0]
    dt: 0.0065
    variables: ['u', 'v', 'w', 'p']

  normalize: true
  cache_dir: "./data/jhtdb/channel_flow_re1000"

normalization:
  type: 'training_data_norm'
  params: {}
  noise_sigma: 0.01  # é™ä½é›œè¨Šä»¥åˆ©ä½ Re è¨“ç·´
  dropout_prob: 0.05

  slice_config:
    plane: "3d_slab"
    z_range: [4.0, 5.5]
    steady_state: true
    time_average_window: [20.0, 26.0]

# =============================================================================
# æ„Ÿæ¸¬é»é…ç½®
# =============================================================================
sensors:
  K: 200  # è¼ƒå¤šæ„Ÿæ¸¬é»ä»¥ç©©å®šè¨“ç·´
  selection_method: "qr_pivot"
  spatial_coverage: "optimal"

# =============================================================================
# æ¨¡å‹æ¶æ§‹ï¼ˆFourier Ïƒ=2-5 å¼·åŒ–å£é¢é«˜é »ï¼‰
# =============================================================================
model:
  type: "enhanced_fourier_mlp"
  in_dim: 3
  out_dim: 4
  width: 256
  depth: 6
  activation: "sine"

  # â­ Fourier Features: Ïƒ=2-5 å¼·åŒ–å£é¢é«˜é »çµæ§‹
  fourier_features:
    type: "standard"
    fourier_m: 64  # å¢åŠ  Fourier ç‰¹å¾µæ•¸ä»¥æ•æ‰é«˜é »
    fourier_sigma: 3.0  # æ¨è–¦ç¯„åœä¸­é–“å€¼ (2-5)
    fourier_trainable: false

  scaling:
    learnable: true
    input_norm: "channel_flow"
    output_norm: "friction_velocity"
    friction_velocity: 0.04997
    channel_half_height: 1.0
    viscous_length: 1.0e-3

# =============================================================================
# ç‰©ç†é…ç½®ï¼ˆåŸºç¤åƒæ•¸ï¼Œå„éšæ®µæœƒè¦†è“‹ nuï¼‰
# =============================================================================
physics:
  type: "vs_pinn_channel_flow"

  # VS-PINN ç¸®æ”¾ä¿‚æ•¸ï¼ˆy æ–¹å‘å£é¢å‰›æ€§æœ€å¤§ï¼‰
  scaling_factors:
    N_x: 2.0
    N_y: 12.0
    N_z: 2.0

  # åŸºç¤ç‰©ç†åƒæ•¸ï¼ˆRe_tau=1000 å°æ‡‰ï¼‰
  Re_tau: 1000.0
  Re_bulk: 39998.0
  nu: 5.0e-5  # åˆå§‹å€¼ï¼Œå„éšæ®µæœƒèª¿æ•´
  dP_dx: 0.0025  # å£“åŠ›æ¢¯åº¦ï¼ˆé©…å‹•æµå‹•ï¼‰
  rho: 1.0

  domain:
    x: [0, 25.13]
    y: [-1.0, 1.0]
    z: [0, 9.42]

  boundary_conditions:
    walls: "no_slip"
    periodic_directions: ["x", "z"]

# =============================================================================
# æå¤±æ¬Šé‡é…ç½®ï¼ˆå„éšæ®µæœƒèª¿æ•´ï¼‰
# =============================================================================
losses:
  # åŸºç¤æ¬Šé‡
  data_weight: 10.0
  momentum_x_weight: 2.0
  momentum_y_weight: 2.0
  momentum_z_weight: 2.0
  continuity_weight: 2.0
  wall_constraint_weight: 10.0
  periodicity_weight: 5.0

  # GradNorm å‹•æ…‹å¹³è¡¡
  adaptive_weighting: true
  weight_update_freq: 1000  # é…åˆ VS-PINN ä½¿ç”¨ä½é »æ›´æ–°
  grad_norm_alpha: 1.5  # æå‡éŸ¿æ‡‰å¼·åº¦

# =============================================================================
# â­ Reynolds æ•¸éå¢ Curriculumï¼ˆRe_b: 100 â†’ 1000ï¼‰
# =============================================================================
curriculum:
  enable: true

  stages:
    # ================================================================
    # éšæ®µ 1: ä½ Reynolds æ•¸æš–å•Ÿ (Re_b â‰ˆ 100, Re_tau â‰ˆ 25)
    # ç›®çš„ï¼šå»ºç«‹åŸºæœ¬æµå ´çµæ§‹ï¼Œé¿å…é«˜ Re æ•¸å€¼ä¸ç©©å®š
    # ================================================================
    - name: "Stage1_LowReynolds_Warmup"
      epoch_range: [0, 800]

      # â­ ä½ Reynolds æ•¸é…ç½®
      Re_tau: 25.0  # Re_b = 25 * 2 * 2 â‰ˆ 100
      Re_bulk: 100.0
      nu: 2.0e-3  # Î½ = 1 / Re_tau â‰ˆ 0.04 / 25 = 0.0016
      pressure_gradient: 0.004  # èª¿æ•´å£“åŠ›æ¢¯åº¦ä»¥ç¶­æŒæµå‹•

      lr: 1.0e-3

      weights:
        data: 10.0
        boundary: 10.0
        momentum_x: 3.0  # ä½ Re æ™‚é»æ€§é …ä¸»å°
        momentum_y: 3.0
        momentum_z: 3.0
        continuity: 3.0
        wall_constraint: 15.0  # å¼·åˆ¶å£é¢æ¢ä»¶
        periodicity: 5.0

      sampling:
        pde_points: 1024  # ä½ Re å¯ç”¨è¼ƒå°‘é»
        boundary_points: 800
        wall_clustering: 0.4  # å¼·åŒ–å£é¢æ¡æ¨£

      stage_goals:
        pde_ratio_min: 0.20
        tau_w_ratio_min: 0.5
        loss_reduction_factor: 0.3

    # ================================================================
    # éšæ®µ 2: ä¸­ç­‰ Reynolds æ•¸éæ¸¡ (Re_b â‰ˆ 400, Re_tau â‰ˆ 100)
    # ç›®çš„ï¼šé€æ­¥å¼•å…¥æ¹æµç‰¹æ€§
    # ================================================================
    - name: "Stage2_MediumReynolds_Transition"
      epoch_range: [800, 1800]

      # â­ ä¸­ç­‰ Reynolds æ•¸é…ç½®
      Re_tau: 100.0  # Re_b = 100 * 2 * 2 = 400
      Re_bulk: 400.0
      nu: 5.0e-4  # Î½ = 1 / Re_tau â‰ˆ 0.04 / 100 = 0.0004
      pressure_gradient: 0.003

      lr: 5.0e-4  # é™ä½å­¸ç¿’ç‡

      weights:
        data: 10.0
        boundary: 10.0
        momentum_x: 5.0  # å°æµé …é–‹å§‹é‡è¦
        momentum_y: 5.0
        momentum_z: 5.0
        continuity: 5.0
        wall_constraint: 12.0
        periodicity: 5.0

      sampling:
        pde_points: 2048  # å¢åŠ æ¡æ¨£é»
        boundary_points: 1000
        wall_clustering: 0.35

      stage_goals:
        pde_ratio_min: 0.25
        tau_w_ratio_min: 1.0
        u_l2_target: 0.30

    # ================================================================
    # éšæ®µ 3: é«˜ Reynolds æ•¸ç²¾ç…‰ (Re_b â‰ˆ 1000, Re_tau â‰ˆ 250)
    # ç›®çš„ï¼šæ¥è¿‘ç›®æ¨™ Re æ•¸ï¼Œå¼·åŒ–æ¹æµçµæ§‹
    # ================================================================
    - name: "Stage3_HighReynolds_Refinement"
      epoch_range: [1800, 3000]

      # â­ æ¥è¿‘ç›®æ¨™ Reynolds æ•¸
      Re_tau: 250.0  # Re_b = 250 * 2 * 2 = 1000
      Re_bulk: 1000.0
      nu: 2.0e-4  # Î½ = 1 / Re_tau â‰ˆ 0.04 / 250 = 0.00016
      pressure_gradient: 0.0025

      lr: 3.0e-4

      weights:
        data: 10.0
        boundary: 10.0
        momentum_x: 8.0  # PDE ä¸»å°
        momentum_y: 8.0
        momentum_z: 8.0
        continuity: 8.0
        wall_constraint: 10.0
        periodicity: 5.0

      sampling:
        pde_points: 4096  # é«˜ Re éœ€è¦æ›´å¤šé»
        boundary_points: 1200
        wall_clustering: 0.30

      stage_goals:
        pde_ratio_min: 0.30
        tau_w_ratio_min: 3.0
        u_l2_target: 0.20
        mass_conservation_target: 1.0e-3

    # ================================================================
    # éšæ®µ 4: ç›®æ¨™ Reynolds æ•¸æ”¶æ–‚ (Re_b â‰ˆ 40000, Re_tau = 1000)
    # ç›®çš„ï¼šé”åˆ° JHTDB å¯¦éš› Re æ•¸ï¼Œæœ€çµ‚æ”¶æ–‚
    # ================================================================
    - name: "Stage4_TargetReynolds_Convergence"
      epoch_range: [3000, 5000]

      # â­ ç›®æ¨™ Reynolds æ•¸ï¼ˆJHTDB Re_tau=1000ï¼‰
      Re_tau: 1000.0
      Re_bulk: 39998.0
      nu: 5.0e-5  # JHTDB å¯¦éš›é»åº¦
      pressure_gradient: 0.0025

      lr: 1.0e-4  # å¾®èª¿å­¸ç¿’ç‡

      weights:
        data: 8.0  # ç•¥é™è³‡æ–™æ¬Šé‡
        boundary: 8.0
        momentum_x: 10.0  # PDE ä¸»å°
        momentum_y: 10.0
        momentum_z: 10.0
        continuity: 10.0
        wall_constraint: 10.0
        periodicity: 5.0

      sampling:
        pde_points: 8192  # æœ€å¤§æ¡æ¨£å¯†åº¦
        boundary_points: 1500
        wall_clustering: 0.25

      stage_goals:
        pde_ratio_min: 0.35
        tau_w_ratio_min: 5.0
        u_l2_target: 0.15
        mass_conservation_target: 5.0e-4
        wall_shear_stress_error: 0.20

# =============================================================================
# è¨“ç·´é…ç½®
# =============================================================================
training:
  epochs: 5000
  batch_size: 8192

  optimizer:
    type: "adam"
    lr: 1.0e-3  # éšæ®µ 1 åˆå§‹å€¼
    betas: [0.9, 0.999]
    weight_decay: 0.0

  scheduler:
    type: "cosine_annealing"
    T_max: 5000
    eta_min: 1.0e-6

  gradient_clip_val: 1.0
  use_amp: true  # è‡ªå‹•æ··åˆç²¾åº¦

# =============================================================================
# æ¡æ¨£é…ç½®ï¼ˆéšæ®µ 1 åˆå§‹å€¼ï¼‰
# =============================================================================
sampling:
  pde_points: 1024
  boundary_points: 800
  data_points: -1
  ic_points: 0

  wall_clustering: 0.4
  adaptive_sampling:
    enabled: false

# =============================================================================
# è©•ä¼°è¨­å®š
# =============================================================================
evaluation:
  grid_resolution: [128, 64, 16]

  metrics:
    - "relative_l2"
    - "wall_shear_stress"
    - "mass_conservation"
    - "mean_velocity_profile"
    - "turbulent_kinetic_energy"
    - "reynolds_stress"

  thresholds:
    l2_error: 0.15
    mass_conservation_error: 5.0e-4
    wall_shear_stress_error: 0.20
    mean_profile_correlation: 0.95

# =============================================================================
# ç‰©ç†é©—è­‰ï¼ˆè¨ºæ–·æ¨¡å¼ï¼‰
# =============================================================================
physics_validation:
  enabled: true
  strict_mode: false  # è¨ºæ–·æ¨¡å¼ï¼Œä¸æ‹’çµ•ä¿å­˜
  save_metrics: true
  thresholds:
    mass_conservation: 1.0e-2
    momentum_conservation: 1.0e-1
    boundary_condition: 1.0e-3

# =============================================================================
# è¼¸å‡ºé…ç½®
# =============================================================================
output:
  checkpoint_dir: "./checkpoints/curriculum_reynolds_ramp_v1"
  results_dir: "./results/curriculum_reynolds_ramp_v1"
  visualization_dir: "./results/curriculum_reynolds_ramp_v1/visualizations"
  log_dir: "./log/curriculum_reynolds_ramp_v1"

# =============================================================================
# æ—¥èªŒé…ç½®
# =============================================================================
logging:
  frequency: 50
  print_freq: 10
  save_freq: 200
  save_stage_checkpoints: true  # æ¯éšæ®µçµæŸæ™‚ä¿å­˜

  wandb:
    enabled: false
    project: "pinns-mvp-curriculum"
    entity: "your-wandb-username"
    tags: ["curriculum", "reynolds_ramp", "channel_flow"]

  tensorboard:
    enabled: true
    log_dir: "./runs/curriculum_reynolds_ramp_v1"

  curriculum:
    log_stage_transitions: true
    log_physics_params: true

# =============================================================================
# ä½¿ç”¨èªªæ˜
# =============================================================================
usage_notes: |
  â­ Reynolds æ•¸éå¢ Curriculum è¨“ç·´ç­–ç•¥

  ğŸ“‹ è¨“ç·´æµç¨‹ï¼š
  1. Stage 1 (0-800 epochs): Re_b â‰ˆ 100
     - ä½ Reynolds æ•¸æš–å•Ÿï¼Œå»ºç«‹åŸºæœ¬æµå ´
     - é»æ€§é …ä¸»å°ï¼Œæ•¸å€¼ç©©å®š

  2. Stage 2 (800-1800 epochs): Re_b â‰ˆ 400
     - é€æ­¥å¼•å…¥å°æµé …
     - æ¹æµç‰¹æ€§é–‹å§‹é¡¯ç¾

  3. Stage 3 (1800-3000 epochs): Re_b â‰ˆ 1000
     - æ¥è¿‘ç›®æ¨™ Re æ•¸
     - å¼·åŒ–æ¹æµçµæ§‹æ•æ‰

  4. Stage 4 (3000-5000 epochs): Re_tau = 1000
     - ç›®æ¨™ JHTDB Re æ•¸
     - æœ€çµ‚ç²¾ç…‰æ”¶æ–‚

  ğŸ¯ Fourier Features ç­–ç•¥ï¼š
  - Ïƒ = 3.0 (æ¨è–¦ç¯„åœ 2-5)
  - å¼·åŒ–å£é¢é«˜é »çµæ§‹æ•æ‰
  - é…åˆ wall_clustering=0.25-0.4

  âš™ï¸ åŸ·è¡Œå‘½ä»¤ï¼š
  python scripts/train.py --cfg configs/templates/curriculum_reynolds_ramp.yml

  ğŸ“Š ç›£æ§æŒ‡æ¨™ï¼š
  - PDE Loss Ratio â‰¥ 30% (æœ€çµ‚éšæ®µ â‰¥ 35%)
  - Wall Shear Stress Error < 20%
  - Mass Conservation Error < 0.05%

  âš ï¸  æ³¨æ„äº‹é …ï¼š
  - è¨“ç·´æ™‚é–“ç´„ 2-4 å°æ™‚ï¼ˆå–æ±ºæ–¼ç¡¬é«”ï¼‰
  - å»ºè­°ä½¿ç”¨ GPU + AMP åŠ é€Ÿ
  - æ¯éšæ®µçµæŸæœƒè‡ªå‹•ä¿å­˜æª¢æŸ¥é»
  - å¯æ ¹æ“šå¯¦éš›æƒ…æ³èª¿æ•´ Re æ•¸éå¢é€Ÿåº¦

# =============================================================================
# åƒè€ƒæ–‡ç»èˆ‡ç†è«–ä¾æ“š
# =============================================================================
references:
  - title: "Variable-Scaling Physics-Informed Neural Networks"
    arxiv: "arXiv:2308.08468"
    note: "VS-PINN ç¸®æ”¾ç­–ç•¥"

  - title: "Curriculum Learning for Physics-Informed Neural Networks"
    note: "Reynolds æ•¸éå¢ç­–ç•¥ç†è«–ä¾æ“š"

  - title: "JHTDB Channel Flow Re_tau=1000"
    note: "ç›®æ¨™æ•¸æ“šé›†èˆ‡ç‰©ç†åƒæ•¸"

  - title: "Fourier Features for High-Frequency Reconstruction"
    note: "Ïƒ=2-5 å£é¢é«˜é »çµæ§‹æ•æ‰"
