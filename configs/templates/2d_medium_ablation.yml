# ğŸ§ª 2D ä¸­æœŸæ¶ˆèå¯¦é©—æ¨¡æ¿
# ç”¨é€”ï¼šç‰¹å¾µæ¶ˆèç ”ç©¶ã€åƒæ•¸æ•æ„Ÿåº¦åˆ†æã€å°ç…§å¯¦é©—
# é æœŸæ™‚é–“ï¼š15-30 åˆ†é˜ï¼ˆ500-1000 epochsï¼‰
# ç›®æ¨™ï¼šé‡åŒ–ç‰¹å¾µè²¢ç»ã€å»ºç«‹åŸºç·šå°ç…§

# =============================================================================
# åŸºæœ¬å¯¦é©—è¨­å®š
# =============================================================================
experiment:
  name: "2d_medium_ablation_fourier"  # âš ï¸ ä¿®æ”¹ç‚ºä½ çš„å¯¦é©—åç¨±
  version: "v1.0"
  seed: 42
  device: "auto"
  precision: "float32"
  description: "Ablation study - Fourier feature impact"

# =============================================================================
# é‡ç¾æ€§è¨­å®š
# =============================================================================
reproducibility:
  deterministic: true
  benchmark: false
  num_workers: 4

# =============================================================================
# è³‡æ–™é…ç½®ï¼ˆ2D åˆ‡ç‰‡ï¼‰
# =============================================================================
data:
  source: "jhtdb"
  dataset: "channel"
  
  jhtdb_config:
    enabled: true
    dataset_name: "channel"
    description: "é€šé“æµ (Re_tau=1000) - 2D åˆ‡ç‰‡"
    domain:
      x: [0, 25.13]
      y: [-1.0, 1.0]
      z: [0, 9.42]
    resolution:
      x: 2048
      y: 512
      z: 1536
    time_range: [0.0, 26.0]
    dt: 0.0065
    variables: ['u', 'v', 'w', 'p']
  
  normalize: true
  cache_dir: "./data/jhtdb/channel_flow_re1000"

normalization:
  type: 'training_data_norm'
  params: {}
  noise_sigma: 0.02  # æ¨™æº–å™ªè²
  dropout_prob: 0.10  # æ¨™æº–éºå¤±ç‡
  
  slice_config:
    plane: "xy"
    z_position: 4.71
    steady_state: true
    time_average_window: [20.0, 26.0]

# =============================================================================
# æ„Ÿæ¸¬é»é…ç½®ï¼ˆä¸­ç­‰ç¨€ç–åº¦ï¼‰
# =============================================================================
sensors:
  K: 100  # ä¸­ç­‰æ„Ÿæ¸¬é»æ•¸é‡
  selection_method: "qr_pivot"
  spatial_coverage: "optimal"

# =============================================================================
# æ¨¡å‹æ¶æ§‹ï¼ˆæ¨™æº–é…ç½®ï¼‰
# =============================================================================
model:
  type: "enhanced_fourier_mlp"
  in_dim: 3
  out_dim: 4
  width: 256  # æ¨™æº–å¯¬åº¦
  depth: 6    # æ¨™æº–æ·±åº¦
  activation: "sine"
  
  # âš ï¸ æ¶ˆèè®Šæ•¸ 1: Fourier ç‰¹å¾µï¼ˆå¯é–‹é—œï¼‰
  fourier_features:
    type: "axis_selective"
    axes_config: {x: [1, 2], y: [], z: [1, 2]}
    full_axes_config: {x: [1, 2, 4, 8], y: [], z: [1, 2, 4, 8]}
    domain_lengths: {x: 25.13, y: 2.0, z: 9.42}
    fourier_m: 32
    fourier_sigma: 5.0
    # ğŸ§ª æ¶ˆèæ¸¬è©¦ï¼šè¨­ç‚º fourier_m: 0 ä¾†ç¦ç”¨ Fourier ç‰¹å¾µ
  
  scaling:
    learnable: true
    input_norm: "channel_flow"
    output_norm: "friction_velocity"
    friction_velocity: 0.04997
    channel_half_height: 1.0
    viscous_length: 1.0e-3

# =============================================================================
# ç‰©ç†è¨­å®š
# =============================================================================
physics:
  type: "vs_pinn_channel_flow"
  nu: 5.0e-5
  rho: 1.0
  
  vs_pinn:
    scaling_factors:
      N_x: 2.0
      N_y: 12.0
      N_z: 2.0
    
    loss_config:
      warmup_epochs: 5
    
    boundary_config:
      boundary_band_width: 5.0e-3
    
    # âš ï¸ æ¢¯åº¦æª¢æŸ¥é»é…ç½®ï¼ˆå¿…é ˆç¦ç”¨ä»¥é¿å…é«˜éšå°æ•¸è¡çªï¼‰
    use_gradient_checkpointing: false  # ç¦ç”¨ä»¥å…¼å®¹ PINNs é«˜éšå°æ•¸
    
    enable_rans: false
  
  channel_flow:
    Re_tau: 1000.0
    Re_bulk: 39998.0
    u_tau: 0.04997
    pressure_gradient: 0.0025
    
  domain:
    x_range: [0.0, 25.13]
    y_range: [-1.0, 1.0]
    z_range: [0.0, 9.42]
    
  boundary_conditions:
    wall_velocity: [0.0, 0.0, 0.0]
    wall_location: [-1.0, 1.0]
    periodic_x: true
    periodic_z: true
    pressure_driven: true
    mean_pressure_gradient: 0.0025

# =============================================================================
# æå¤±å‡½æ•¸æ¬Šé‡ï¼ˆæ¨™æº–é…ç½® + è‡ªé©æ‡‰ï¼‰
# =============================================================================
losses:
  # åŸºç¤æ¬Šé‡ï¼ˆå¹³è¡¡ï¼‰
  data_weight: 5.0
  boundary_weight: 5.0
  
  momentum_x_weight: 5.0
  momentum_y_weight: 5.0
  momentum_z_weight: 5.0
  continuity_weight: 5.0
  
  wall_constraint_weight: 10.0
  periodicity_weight: 2.0
  pressure_gradient_weight: 1.0
  
  prior_weight: 0.3
  source_l1: 1.0e-6
  gradient_penalty: 1.0e-4
  
  # âš ï¸ æ¶ˆèè®Šæ•¸ 2: è‡ªé©æ‡‰æ¬Šé‡ï¼ˆå¯é–‹é—œï¼‰
  adaptive_weighting: true  # ğŸ§ª è¨­ç‚º false ä¾†ç¦ç”¨
  weight_update_freq: 50
  grad_norm_alpha: 1.5
  
  adaptive_loss_terms:
    - data
    - momentum_x
    - momentum_y
    - momentum_z
    - continuity
    - wall_constraint
    - periodicity
  
  causal_weighting: false

# =============================================================================
# è¨“ç·´è¨­å®šï¼ˆä¸­æœŸï¼‰
# =============================================================================
training:
  optimizer: "adam"
  lr: 1.0e-3
  weight_decay: 1.0e-5
  
  lr_scheduler:
    type: "warmup_cosine"
    min_lr: 1.0e-6
    warmup_epochs: 50
    T_max: 1000
  
  epochs: 1000  # ä¸­æœŸè¨“ç·´
  max_epochs: 1000
  batch_size: 1024
  validation_freq: 50
  checkpoint_freq: 100
  log_interval: 20
  
  early_stopping:
    enabled: true
    patience: 200
    min_delta: 1.0e-7
  
  sampling:
    pde_points: 2048
    boundary_points: 1000
    wall_clustering: 0.3
  
  gradient_clip: 1.0
  
  # æ··åˆç²¾åº¦è¨“ç·´ï¼ˆAMPï¼‰
  amp:
    enabled: true  # âœ… æ¶ˆèç ”ç©¶å»ºè­°å•Ÿç”¨ï¼ˆåŠ é€Ÿå¯¦é©—è¿­ä»£ï¼‰
    # èªªæ˜ï¼š
    #   - å¯åŠ é€Ÿè¨“ç·´ 1.5-2xï¼ˆç¯€çœå¯¦é©—æ™‚é–“ï¼‰
    #   - è¨˜æ†¶é«”ç¯€çœ 30-50%ï¼ˆå¯å¢åŠ æ‰¹æ¬¡å¤§å°ï¼‰
    #   - æ•¸å€¼ç©©å®šæ€§å·²é©—è­‰ï¼ˆèˆ‡ FP32 çµæœä¸€è‡´ï¼‰
    #   - âš ï¸ åƒ…æ”¯æ´ CUDA è¨­å‚™ï¼ˆMPS ä¸æ”¯æ´ï¼‰
    #   - é©åˆå¿«é€Ÿè¿­ä»£å¤šçµ„æ¶ˆèå¯¦é©—

# âš ï¸ é—œé–‰èª²ç¨‹å­¸ç¿’ï¼ˆæ¶ˆèç ”ç©¶é€šå¸¸å–®éšæ®µï¼‰
curriculum:
  enable: false

ensemble:
  enable: false

# =============================================================================
# è©•ä¼°è¨­å®š
# =============================================================================
evaluation:
  grid_resolution: [128, 64, 64]
  
  metrics:
    - "relative_l2"
    - "wall_shear_stress"
    - "mass_conservation"
    - "mean_velocity_profile"
    - "turbulent_kinetic_energy"
    - "reynolds_stress"
  
  thresholds:
    l2_error: 0.30
    mass_conservation_error: 1.0e-3
    wall_shear_stress_error: 0.30
    mean_profile_correlation: 0.85

# =============================================================================
# ç‰©ç†é©—è­‰ï¼ˆæª¢æŸ¥é»ä¿å­˜å‰ï¼‰
# =============================================================================
physics_validation:
  enabled: true  # é è¨­å•Ÿç”¨ï¼Œç¢ºä¿ä¿å­˜çš„æª¢æŸ¥é»ç¬¦åˆç‰©ç†ç´„æŸ
  save_metrics: true  # åœ¨æª¢æŸ¥é»å…ƒæ•¸æ“šä¸­è¨˜éŒ„ç‰©ç†æŒ‡æ¨™

  thresholds:
    mass_conservation: 1.0e-2       # è³ªé‡å®ˆæ†æœ€å¤§æ•£åº¦èª¤å·®
    momentum_conservation: 1.0e-1   # å‹•é‡å®ˆæ†å¹³å‡æ®˜å·®
    boundary_condition: 1.0e-3      # å£é¢é‚Šç•Œæ¢ä»¶æœ€å¤§èª¤å·®

  # èªªæ˜ï¼š
  #   - è‹¥é©—è­‰å¤±æ•—ï¼Œæª¢æŸ¥é»ä¿å­˜å°‡è¢«æ‹’çµ•ä¸¦è¨˜éŒ„è­¦å‘Š
  #   - å¯é€é enabled: false ç¦ç”¨ï¼ˆåƒ…ç”¨æ–¼é™¤éŒ¯ï¼‰
  #   - é–¾å€¼å¯æ ¹æ“šç²¾åº¦éœ€æ±‚èª¿æ•´

# =============================================================================
# æ—¥èªŒèˆ‡å„²å­˜
# =============================================================================
logging:
  level: "info"
  log_freq: 20
  save_predictions: true
  tensorboard: true
  wandb: false
  
  save_loss_history: true
  save_weight_evolution: true  # è¿½è¹¤æ¬Šé‡æ¼”åŒ–

output:
  checkpoint_dir: "./checkpoints/2d_medium_ablation_fourier"
  results_dir: "./results/2d_medium_ablation_fourier"
  visualization_dir: "./results/2d_medium_ablation_fourier/visualizations"

# =============================================================================
# é©—æ”¶æ¨™æº–ï¼ˆå°ç…§åŸºç·šï¼‰
# =============================================================================
test_acceptance:
  stability:
    - no_nan_inf: true
    - loss_finite: true
    - gradient_stable: true
  
  performance:
    - u_l2_error_target: 0.30
    - pde_loss_ratio_target: 0.30
    - wall_shear_stress_error_target: 0.30
  
  # æ¶ˆèç ”ç©¶ç‰¹å®šæŒ‡æ¨™
  ablation_metrics:
    - baseline_l2_comparison: true  # éœ€èˆ‡åŸºç·šå°ç…§
    - delta_l2_threshold: 0.10  # Î”L2 â‰¥ 10% è¦–ç‚ºé¡¯è‘—å·®ç•°
    - convergence_speed_ratio: true  # æ”¶æ–‚é€Ÿåº¦å°æ¯”

# =============================================================================
# ä½¿ç”¨èªªæ˜
# =============================================================================
usage_notes: |
  ğŸ¯ ç”¨é€”ï¼š
    - ç‰¹å¾µæ¶ˆèç ”ç©¶ï¼ˆFourier/Adaptive/RANSï¼‰
    - åƒæ•¸æ•æ„Ÿåº¦åˆ†æ
    - å»ºç«‹å°ç…§åŸºç·š
    - é‡åŒ–ç‰¹å¾µè²¢ç»
  
  ğŸ§ª æ¶ˆèè®Šæ•¸ï¼š
    1. Fourier ç‰¹å¾µï¼šfourier_m (0/16/32/64)
    2. è‡ªé©æ‡‰æ¬Šé‡ï¼šadaptive_weighting (true/false)
    3. ç¶²è·¯å¯¬åº¦ï¼šwidth (128/256/512)
    4. æ„Ÿæ¸¬é»æ•¸ï¼šK (50/100/200)
  
  ğŸ“Š å°ç…§å¯¦é©—è¨­è¨ˆç¯„ä¾‹ï¼š
    å¯¦é©— A (baseline):      fourier_m=32, adaptive=true
    å¯¦é©— B (no_fourier):    fourier_m=0,  adaptive=true
    å¯¦é©— C (no_adaptive):   fourier_m=32, adaptive=false
    å¯¦é©— D (minimal):       fourier_m=0,  adaptive=false
  
  âœ… æˆåŠŸæ¨™æº–ï¼š
    1. L2 < 30%ï¼ˆåˆæ ¼ç²¾åº¦ï¼‰
    2. PDE ratio > 30%ï¼ˆç‰©ç†åƒèˆ‡ï¼‰
    3. ç›¸å°åŸºç·š Î”L2 å¯é‡åŒ–ï¼ˆâ‰¥10% è¦–ç‚ºé¡¯è‘—ï¼‰
  
  ğŸš€ ä½¿ç”¨ç¯„ä¾‹ï¼š
    # åŸºç·šå¯¦é©—
    python scripts/train.py --cfg configs/templates/2d_medium_ablation.yml
    
    # æ¶ˆèå¯¦é©—ï¼ˆä¿®æ”¹é…ç½®å¾Œï¼‰
    python scripts/train.py --cfg configs/2d_ablation_no_fourier.yml
  
  ğŸ“ˆ é æœŸçµæœï¼š
    - è¨“ç·´æ™‚é–“ï¼š15-30 åˆ†é˜ï¼ˆGPUï¼‰
    - æœ€çµ‚ L2ï¼š20-30%
    - PDE ratioï¼š30-40%
    - å¯é‡åŒ–ç‰¹å¾µè²¢ç»ï¼ˆÎ”L2 = 5-15%ï¼‰
  
  âš ï¸ æ³¨æ„äº‹é …ï¼š
    - éœ€ä¿æŒå…¶ä»–è®Šæ•¸ä¸è®Šï¼ˆæ§åˆ¶è®Šå› ï¼‰
    - å»ºè­°ä½¿ç”¨ç›¸åŒ seedï¼ˆå¯é‡ç¾æ€§ï¼‰
    - è‡³å°‘é‡è¤‡ 3 æ¬¡å¯¦é©—ï¼ˆçµ±è¨ˆé¡¯è‘—æ€§ï¼‰
    - è¨˜éŒ„æ‰€æœ‰è¶…åƒæ•¸åˆ°å¯¦é©—æ—¥èªŒ

# =============================================================================
# æ¶ˆèå¯¦é©—è¨ˆç•«ç¯„ä¾‹
# =============================================================================
ablation_experiment_plan:
  baseline:
    config: "2d_medium_ablation_fourier_full.yml"
    fourier_m: 32
    adaptive_weighting: true
    K: 100
    expected_l2: 0.25
  
  ablation_fourier:
    config: "2d_medium_ablation_no_fourier.yml"
    fourier_m: 0  # âš ï¸ å”¯ä¸€è®Šæ•¸
    adaptive_weighting: true
    K: 100
    hypothesis: "L2 å¢åŠ  10-15%ï¼ˆé«˜é »æ•æ‰èƒ½åŠ›ä¸‹é™ï¼‰"
  
  ablation_adaptive:
    config: "2d_medium_ablation_fixed_weights.yml"
    fourier_m: 32
    adaptive_weighting: false  # âš ï¸ å”¯ä¸€è®Šæ•¸
    K: 100
    hypothesis: "PDE ratio ä¸‹é™è‡³ 15-20%ï¼ˆæ¬Šé‡å¤±è¡¡ï¼‰"
  
  ablation_sparse:
    config: "2d_medium_ablation_k50.yml"
    fourier_m: 32
    adaptive_weighting: true
    K: 50  # âš ï¸ å”¯ä¸€è®Šæ•¸
    hypothesis: "L2 å¢åŠ  5-10%ï¼ˆè³‡è¨Šä¸è¶³ï¼‰"
