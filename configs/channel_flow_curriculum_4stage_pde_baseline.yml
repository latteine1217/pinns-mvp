# Channel Flow Curriculum Training - PDE Baseline (6000 epochs)
# ğŸ¯ åŸºæ–¼ PDE = 1.0 å›ºå®šåŸºæº–çš„æ¬Šé‡ç­–ç•¥
# âœ… é©—è­‰é€šéï¼šData Loss ä¸‹é™ 78.4%ï¼ˆ200 epochs æ¸¬è©¦ï¼‰
# ğŸ“Š æ”¹é€²ï¼šæ˜ç¢ºæ¨™è¨» PDE åŸºæº–ï¼Œæ‰€æœ‰æ¬Šé‡ä»¥ç›¸å°å€æ•¸è¡¨ç¤º

experiment:
  name: "pinnx_channel_flow_curriculum_pde_baseline"
  version: "v5.0_pde_baseline"
  seed: 42
  device: "auto"
  precision: "float32"
  description: "âœ… PDE = 1.0 åŸºæº–ç­–ç•¥ + èª²ç¨‹è¨“ç·´"

initial_condition:
  enabled: true
  use_data: true
  n_points: 256
  time: 0.0

inlet:
  enabled: true
  n_points: 64
  x_position: -1.0

data:
  source: "jhtdb"
  dataset: "channel"
  
  jhtdb_config:
    enabled: true
    dataset_name: "channel"
    description: "é€šé“æµ (Re_tau=1000)"
    domain:
      x: [0, 25.13]
      y: [-1.0, 1.0]
      z: [0, 9.42]
    resolution:
      x: 2048
      y: 512
      z: 1536
    time_range: [0.0, 26.0]
    dt: 0.0065
    variables: ['u', 'v', 'p']
  
  normalize: true
  cache_dir: "./data/jhtdb/channel_flow_re1000"
  noise_sigma: 0.02
  dropout_prob: 0.10
  
  slice_config:
    plane: "xy"
    z_position: 4.71
    steady_state: true
    time_average_window: [20.0, 26.0]

sensors:
  K: 80
  selection_method: "wall_balanced"
  sensor_file: "sensors_K80_wall_balanced.npz"
  
  spatial_coverage: "proportional_layering"
  layer_allocation: [8, 24, 15, 24, 9]
  sampling_method: "u_quantile"

model:
  type: "fourier_mlp"
  in_dim: 2
  out_dim: 3
  width: 256
  depth: 6
  activation: "sine"
  
  fourier_m: 48
  fourier_sigma: 3.0
  
  scaling:
    learnable: false
    input_norm:
      x: [0.0, 25.13]
      y: [-1.0, 1.0]
    output_norm:
      u: [0.0, 16.5]
      v: [-0.5, 0.6]
      p: [-85.0, 3.0]

physics:
  nu: 1.0e-3
  rho: 1.0
  
  channel_flow:
    Re_tau: 1000.0
    Re_bulk: 41980.0
    u_tau: 1.0
    pressure_gradient: -1.0
    
  domain:
    x_range: [0.0, 25.13]
    y_range: [-1.0, 1.0]
    
  boundary_conditions:
    wall_velocity: [0.0, 0.0]
    wall_location: [-1.0, 1.0]
    periodic_x: true
    pressure_driven: true
    mean_pressure_gradient: -1.0

# âœ… 4 éšæ®µèª²ç¨‹è¨“ç·´ï¼ˆPDE = 1.0 å›ºå®šåŸºæº–ï¼‰
# ğŸ“Š æ¬Šé‡èªªæ˜ï¼š
#   - momentum_x/y = 1.0   ğŸ”’ å›ºå®šåŸºæº–ï¼ˆç‰©ç†å®ˆæ†åº•ç·šï¼‰
#   - continuity = 2.0      å®ˆæ†æ–¹ç¨‹é‡è¦æ€§ 2 å€
#   - data = 100.0          è³‡æ–™æ“¬åˆé‡ PDE 100 å€ï¼ˆStage 1ï¼‰
#   - wall/inlet = 5.0      é‚Šç•Œæ¢ä»¶é‡ PDE 5 å€
#   - IC = 10.0             åˆå§‹æ¢ä»¶é‡ PDE 10 å€

curriculum:
  enable: true
  mode: "staged"
  total_epochs: 6000
  
  stages:
    # éšæ®µ 1ï¼šä½é›·è«¾æ•¸ + è³‡æ–™å„ªå…ˆ
    - name: "Stage1_Foundation"
      epoch_range: [0, 1500]
      description: "ğŸ”¥ åŸºç¤ï¼šRe=100, Data ä¸»å° (100x PDE)"
      
      Re_tau: 100.0
      nu: 1.0e-2
      pressure_gradient: -0.1
      
      # æ¬Šé‡åŸºæº–ï¼šPDE = 1.0
      weights:
        # PDE æ®˜å·®ï¼ˆå›ºå®šåŸºæº–ï¼‰
        momentum_x: 1.0              # ğŸ”’ åŸºæº–
        momentum_y: 1.0              # ğŸ”’ åŸºæº–
        continuity: 2.0              # 2x PDEï¼ˆå®ˆæ†é‡è¦ï¼‰
        
        # é‚Šç•Œæ¢ä»¶ï¼ˆç›¸å° PDEï¼‰
        wall_constraint: 5.0         # 5x PDE
        periodicity: 5.0             # 5x PDE
        inlet: 5.0                   # 5x PDE
        initial_condition: 10.0      # 10x PDE
        
        # è³‡æ–™æ“¬åˆï¼ˆä¸»å°éšæ®µï¼‰
        data: 100.0                  # 100x PDE âœ… é©—è­‰æˆåŠŸ
        
        # å…ˆé©—ä¸€è‡´æ€§ï¼ˆé—œé–‰ï¼‰
        prior: 0.0
      
      # ç›¸å°è²¢ç»åº¦ï¼šData 87.7%, BC 13.2%, PDE 3.5%
      
      inlet:
        profile_type: 'parabolic'
        u_max: 6.0
      
      sampling:
        pde_points: 2048
        boundary_points: 3000
      
      lr: 1.0e-3
    
    # éšæ®µ 2ï¼šä¸­é›·è«¾æ•¸ + å¹³è¡¡æ¬Šé‡
    - name: "Stage2_Transition"
      epoch_range: [1500, 3000]
      description: "âš–ï¸ éæ¸¡ï¼šRe=300, å¹³è¡¡ Data/Physics (25x PDE)"
      
      Re_tau: 300.0
      nu: 3.33e-3
      pressure_gradient: -0.33
      
      weights:
        # PDE æ®˜å·®ï¼ˆå›ºå®šåŸºæº–ï¼‰
        momentum_x: 1.0              # ğŸ”’ åŸºæº–
        momentum_y: 1.0              # ğŸ”’ åŸºæº–
        continuity: 2.5              # 2.5x PDEï¼ˆå®ˆæ†å¢å¼·ï¼‰
        
        # é‚Šç•Œæ¢ä»¶
        wall_constraint: 5.0         # 5x PDE
        periodicity: 5.0             # 5x PDE
        inlet: 5.0                   # 5x PDE
        initial_condition: 7.5       # 7.5x PDEï¼ˆé™ä½ï¼‰
        
        # è³‡æ–™æ“¬åˆï¼ˆé™ä½è‡³ 25xï¼‰
        data: 25.0                   # 25x PDEï¼ˆå¾ 100x é™è‡³ 25xï¼‰
        
        prior: 0.0
      
      # ç›¸å°è²¢ç»åº¦ï¼šData 53.2%, BC 23.4%, PDE 9.6%
      
      inlet:
        profile_type: 'parabolic'
        u_max: 12.0
      
      sampling:
        pde_points: 4096
        boundary_points: 4000
      
      lr: 5.0e-4
    
    # éšæ®µ 3ï¼šé«˜é›·è«¾æ•¸ + Physics å¢å¼·
    - name: "Stage3_HighRe"
      epoch_range: [3000, 4500]
      description: "ğŸš€ é«˜ Reï¼šRe=600, Physics å¢å¼· (10x PDE)"
      
      Re_tau: 600.0
      nu: 1.67e-3
      pressure_gradient: -0.67
      
      weights:
        # PDE æ®˜å·®ï¼ˆå›ºå®šåŸºæº–ï¼‰
        momentum_x: 1.0              # ğŸ”’ åŸºæº–
        momentum_y: 1.0              # ğŸ”’ åŸºæº–
        continuity: 2.7              # 2.7x PDE
        
        # é‚Šç•Œæ¢ä»¶
        wall_constraint: 5.0         # 5x PDE
        periodicity: 5.0             # 5x PDE
        inlet: 5.0                   # 5x PDE
        initial_condition: 6.7       # 6.7x PDE
        
        # è³‡æ–™æ“¬åˆï¼ˆé™ä½è‡³ 10xï¼‰
        data: 10.0                   # 10x PDEï¼ˆå¾ 25x é™è‡³ 10xï¼‰
        
        prior: 0.0
      
      # ç›¸å°è²¢ç»åº¦ï¼šData 27.8%, BC 30.6%, PDE 12.5%
      
      inlet:
        profile_type: 'turbulent'
        Re_tau: 600.0
        kappa: 0.41
      
      sampling:
        pde_points: 6144
        boundary_points: 5000
      
      lr: 2.0e-4
    
    # éšæ®µ 4ï¼šç›®æ¨™é›·è«¾æ•¸ç²¾ä¿®
    - name: "Stage4_Refinement"
      epoch_range: [4500, 6000]
      description: "ğŸ¯ ç²¾ä¿®ï¼šRe=1000, æœ€çµ‚å„ªåŒ– (4x PDE)"
      
      Re_tau: 1000.0
      nu: 1.0e-3
      pressure_gradient: -1.0
      
      weights:
        # PDE æ®˜å·®ï¼ˆå›ºå®šåŸºæº–ï¼‰
        momentum_x: 1.0              # ğŸ”’ åŸºæº–
        momentum_y: 1.0              # ğŸ”’ åŸºæº–
        continuity: 2.0              # 2x PDEï¼ˆå›æ­¸å¹³è¡¡ï¼‰
        
        # é‚Šç•Œæ¢ä»¶
        wall_constraint: 4.0         # 4x PDEï¼ˆå¾®èª¿ï¼‰
        periodicity: 4.0             # 4x PDE
        inlet: 4.0                   # 4x PDE
        initial_condition: 5.0       # 5x PDE
        
        # è³‡æ–™æ“¬åˆï¼ˆé™ä½è‡³ 4xï¼‰
        data: 4.0                    # 4x PDEï¼ˆData/PDE æ¯” 4:1ï¼‰
        
        prior: 0.0
      
      # ç›¸å°è²¢ç»åº¦ï¼šData 16.7%, BC 33.3%, PDE 16.7%ï¼ˆæœ€çµ‚å¹³è¡¡ï¼‰
      
      inlet:
        profile_type: 'turbulent'
        Re_tau: 1000.0
        kappa: 0.41
      
      sampling:
        pde_points: 8192
        boundary_points: 6000
      
      lr: 1.0e-4

losses:
  # ğŸ”’ PDE åŸºæº–æ¬Šé‡ï¼ˆé è¨­èˆ‡ Stage1 ä¸€è‡´ï¼‰
  pde_baseline: 1.0  # å›ºå®šåŸºæº–ï¼ˆæ–‡æª”ç”¨é€”ï¼‰
  
  # é è¨­æ¬Šé‡ï¼ˆèˆ‡ Stage1 ä¸€è‡´ï¼‰
  data_weight: 100.0              # 100x PDE
  wall_constraint_weight: 5.0     # 5x PDE
  periodicity_weight: 5.0         # 5x PDE
  inlet_weight: 5.0               # 5x PDE
  initial_condition_weight: 10.0  # 10x PDE
  momentum_x_weight: 1.0          # ğŸ”’ åŸºæº–
  momentum_y_weight: 1.0          # ğŸ”’ åŸºæº–
  continuity_weight: 2.0          # 2x PDE
  prior_weight: 0.0               # é—œé–‰
  
  source_l1: 1.0e-6
  gradient_penalty: 1.0e-4
  
  adaptive_weighting: true
  weight_update_freq: 50
  grad_norm_alpha: 0.15
  
  causal_weighting: false

training:
  optimizer: "adam"
  lr: 1.0e-3
  weight_decay: 1.0e-5
  lr_scheduler: "cosine"
  
  max_epochs: 6000
  batch_size: 1024
  validation_freq: 100
  checkpoint_freq: 100
  early_stopping: false
  patience: 500
  
  sampling:
    pde_points: 2048
    boundary_points: 3000
    wall_clustering: 0.1
    center_enhancement: 0.4
    high_velocity_sampling: 0.3

ensemble:
  enable: false

evaluation:
  grid_resolution: [256, 128]
  
  metrics:
    - "relative_l2"
    - "wall_shear_stress"
    - "velocity_profile"
    - "mass_conservation"
    
  thresholds:
    l2_error: 0.15
    wall_shear_error: 0.10
    velocity_profile_error: 0.08
    rmse_improvement: 0.30
    mass_conservation_error: 0.1
    
  channel_flow_validation:
    log_law_region: [30, 300]
    von_karman_constant: 0.41
    wake_parameter: 0.55

logging:
  level: "info"
  log_freq: 50
  save_predictions: true
  save_checkpoints: true
  
  save_velocity_profiles: true
  save_wall_quantities: true
  save_turbulence_fields: true
  
  monitor_conservation: true
  conservation_check_freq: 50
  
  save_stage_checkpoints: true
  stage_checkpoint_dir: "./checkpoints/curriculum_pde_baseline"
  
  wandb:
    project: "pinnx-channel-flow-pde-baseline"
    entity: null
    tags: ["production", "pde_baseline", "6000epochs", "curriculum"]

reproducibility:
  deterministic: true
  benchmark: false
  num_workers: 4

validation:
  dns_benchmark: true
  dns_data_path: "./data/jhtdb/channel_flow_re1000/dns_reference"
  
  turbulence_statistics:
    reynolds_stress: true
    turbulent_kinetic_energy: true
    dissipation_rate: false
    
  wall_quantities:
    skin_friction: true
    heat_transfer: false
    pressure_fluctuation: true

performance:
  mixed_precision: false
  gradient_checkpointing: false
  vectorized_operations: true
  parallel_sampling: true
  max_gpu_memory_fraction: 0.9
  clear_cache_freq: 500

# ğŸ“Š æ¬Šé‡æ¼”åŒ–ç­–ç•¥æ‘˜è¦
# Stage 1 (0-1500):    Data/PDE = 100:1  (Data ä¸»å°ï¼Œå»ºç«‹åŸºç¤)
# Stage 2 (1500-3000): Data/PDE = 25:1   (å¹³è¡¡éæ¸¡)
# Stage 3 (3000-4500): Data/PDE = 10:1   (Physics å¢å¼·)
# Stage 4 (4500-6000): Data/PDE = 4:1    (æœ€çµ‚å¹³è¡¡)
#
# ç‰©ç†æ„ç¾©ï¼š
# - PDE = 1.0ï¼šç‰©ç†å®ˆæ†åº•ç·šï¼ˆå›ºå®šåŸºæº–ï¼‰
# - Dataï¼šå¾ 100x â†’ 4x é€æ­¥é™ä½ï¼ˆæ—©æœŸè³‡æ–™ä¸»å° â†’ å¾ŒæœŸç‰©ç†ä¸»å°ï¼‰
# - BCï¼šç¶­æŒ 4-5x PDEï¼ˆé‚Šç•Œæ¢ä»¶å§‹çµ‚é‡è¦ï¼‰
# - Continuityï¼š2-2.7x PDEï¼ˆä¸å¯å£“ç¸®æµé«”çš„æ ¸å¿ƒç´„æŸï¼‰
