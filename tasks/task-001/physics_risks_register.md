# 物理風險登記表

**建立時間**: 2025-09-30  
**責任人**: Physicist Sub-Agent  
**更新頻率**: 每次物理審查後更新  

## 風險分級標準

| 級別 | 影響範圍 | 發生概率 | 處理時限 |
|------|----------|----------|----------|
| 🚨 **極高** | 專案阻斷 | 已發生/必然 | 立即 |
| 🔥 **高** | 核心功能異常 | 很可能 | 1-3天 |
| ⚠️ **中** | 部分功能限制 | 可能 | 1-2週 |
| 🟡 **低** | 邊緣情況問題 | 不太可能 | 1個月+ |

---

## 當前風險清單

### 🚨 極高風險

#### R001: API 不一致導致測試失敗
- **風險描述**: `NSEquations2D` 類別缺失，導致 `demo_basic.py` 無法執行，測試套件失敗
- **物理影響**: 無直接物理錯誤，但阻斷驗證流程
- **技術影響**: 
  - 測試通過率從期望 95% 降至當前 81%
  - 阻斷後續開發與集成
- **根本原因**: API 設計與實作不同步
- **檢測指標**: `pytest test_physics.py` 失敗
- **緩解策略**: 
  - ✅ **立即行動**: 建立 `NSEquations2D` 包裝類別
  - ✅ **驗證方法**: 確保 `from pinnx.physics.ns_2d import NSEquations2D` 成功
- **負責人**: 主 Agent
- **狀態**: 🔴 待修復
- **預計解決**: 2025-09-30 (今日內)

---

### 🔥 高風險

#### R002: 數值尺度敏感性風險
- **風險描述**: 在極端尺度比情況下，VS-PINN 尺度化可能導致梯度病態
- **物理影響**: 
  - 梯度消失: 小尺度特徵無法學習
  - 梯度爆炸: 訓練不穩定，模型發散
- **觸發條件**: 
  - 輸入座標範圍 > 1e6 或 < 1e-6
  - 輸出變數尺度差 > 1e8
- **風險場景**: 
  ```python
  # 危險示例：混合極端尺度
  coords = torch.tensor([[1e-8, 1e8], [1e8, 1e-8]])  # 尺度跨越16個數量級
  ```
- **檢測指標**: 
  - 梯度範數 < 1e-12 (消失) 或 > 1e12 (爆炸)
  - 損失函數 NaN/Inf
- **緩解策略**:
  - 🔧 **預防**: 輸入資料預處理，限制尺度範圍在 [1e-3, 1e3]
  - 🔧 **監控**: 添加梯度範數監控與報警
  - 🔧 **自適應**: 實作動態尺度調整機制
- **實作建議**:
  ```python
  def safe_scaling_check(data, max_scale_ratio=1e6):
      scale_range = data.max() / (data.min() + 1e-15)
      if scale_range > max_scale_ratio:
          warnings.warn(f"極端尺度比 {scale_range:.2e}")
  ```
- **負責人**: Debugger + Physicist
- **狀態**: 🟡 監控中
- **預計解決**: task-002

#### R003: 邊界條件物理一致性風險
- **風險描述**: Neumann 和週期邊界條件未完整實作，限制問題適用性
- **物理影響**:
  - 無法處理壁面剪應力 (wall shear stress) 邊界條件
  - 限制週期性流動問題 (如 Kármán vortex street)
  - 可能導致非物理的解
- **影響案例**:
  - 通道流: 需要壁面無滑移條件 + 出入口壓力條件
  - 圓柱繞流: 需要圓柱表面無滑移 + 遠場邊界條件
- **當前限制**: 僅支援 Dirichlet 邊界條件 (指定函數值)
- **緩解策略**:
  - 🔧 **短期**: 使用 Dirichlet 近似 Neumann 條件
  - 🔧 **中期**: 實作完整的 Neumann 邊界條件處理
  - 🔧 **長期**: 建立混合邊界條件框架
- **負責人**: Physicist  
- **狀態**: 🟡 已識別
- **預計解決**: task-003

---

### ⚠️ 中風險

#### R004: 源項模型假設限制風險
- **風險描述**: 當前源項處理假設 y 方向分量為零，限制模型一般性
- **物理影響**:
  - 無法建模具有顯著 y 方向源項的流動 (如浮力驅動流)
  - 限制湍流閉合模型的適用性
  - 可能誤導逆問題源項重建結果
- **影響場景**:
  - 自然對流: 浮力項在垂直方向顯著
  - 湍流模型: Reynolds stress 各方向分量不均
- **當前假設**: `S_y = torch.zeros_like(S)` (L159)
- **緩解策略**:
  - 🔧 **立即可用**: 通過 `source_term` 參數提供完整向量源項
  - 🔧 **改進方向**: 擴展預測輸出為 `[u, v, p, S_x, S_y]`
- **實作建議**:
  ```python
  if pred.shape[1] >= 5:  # 支援 [u, v, p, S_x, S_y]
      S_x, S_y = pred[:, 3:4], pred[:, 4:5]
  else:  # 向後相容
      S_x = pred[:, 3:4]
      S_y = torch.zeros_like(S_x)
  ```
- **負責人**: Physicist
- **狀態**: 🟡 已記錄
- **預計解決**: task-004

#### R005: 壓力參考點不確定性風險
- **風險描述**: N-S 方程式中壓力僅確定到常數，可能影響逆問題穩定性
- **物理影響**:
  - 壓力場解的非唯一性
  - 可能導致訓練過程中壓力漂移
  - 影響壓力相關物理量 (如壓力梯度、升力係數) 的準確性
- **數學背景**: 
  ```
  對於不可壓縮流，只有壓力梯度 ∇p 具有物理意義
  壓力 p 可任意加上常數 C，而不改變動量方程
  ```
- **風險場景**:
  - 缺乏壓力參考點的純 Neumann 問題
  - 長時間訓練導致壓力數值偏移
- **緩解策略**:
  - 🔧 **數值方法**: 添加壓力正規化項 `∫p dV = 0`
  - 🔧 **物理約束**: 在特定點固定壓力值
  - 🔧 **監控指標**: 追蹤壓力均值漂移
- **負責人**: Physicist + Debugger
- **狀態**: 🟡 監控中
- **預計解決**: task-003

---

### 🟡 低風險

#### R006: 高雷諾數數值穩定性風險
- **風險描述**: 高 Re 湍流可能導致對流佔優問題，影響 PINN 收斂性
- **物理背景**:
  - Re = UL/ν >> 1 時，對流項遠大於黏性項
  - 產生多尺度現象，增加 PINN 學習難度
  - 可能出現數值震盪或偽解
- **觸發條件**: Re > 1000 (根據經驗)
- **檢測指標**:
  - 對流項與黏性項比值: `|u·∇u| / |ν∇²u| > 100`
  - 訓練損失震盪或不收斂
- **緩解策略**:
  - 🔧 **數值技術**: 採用 adaptive weighting 策略
  - 🔧 **物理方法**: 引入人工黏性穩定化
  - 🔧 **網路架構**: 使用 Fourier features 提升高頻能力
- **負責人**: Performance + Physicist
- **狀態**: 🟢 監控中
- **預計解決**: 效能最佳化階段

#### R007: 渦量計算精度風險
- **風險描述**: 渦量作為二階導數，對數值誤差敏感，可能影響湍流特徵識別
- **技術影響**:
  - Q-criterion 準確性下降
  - 渦結構識別錯誤
  - 湍流統計量偏差
- **誤差來源**:
  - 自動微分截斷誤差
  - 浮點數精度限制
  - 網路近似誤差
- **緩解策略**:
  - 🔧 **數值方法**: 使用更高精度 (float64)
  - 🔧 **算法改進**: 實作守恆型渦量計算
  - 🔧 **驗證基準**: 與解析解或高精度 DNS 比對
- **負責人**: Physicist
- **狀態**: 🟢 可接受
- **預計解決**: 精度提升需求時

---

## 風險關聯圖

```
R001 (API不一致) 
  ↓ 阻斷
R002 (數值穩定性) ←→ R005 (壓力參考)
  ↓ 影響               ↓ 相關
R003 (邊界條件) ←→ R004 (源項假設)
  ↓ 限制               ↓ 限制  
R006 (高Re穩定性) ←→ R007 (渦量精度)
```

## 風險監控儀表板

### 自動檢測指標
```python
RISK_MONITORS = {
    'R001': lambda: check_api_consistency(),
    'R002': lambda: check_gradient_health(),  
    'R003': lambda: check_boundary_coverage(),
    'R004': lambda: check_source_term_generality(),
    'R005': lambda: check_pressure_stability(),
    'R006': lambda: check_reynolds_number_range(),
    'R007': lambda: check_vorticity_accuracy()
}

def daily_risk_assessment():
    """每日風險評估"""
    for risk_id, check_func in RISK_MONITORS.items():
        status = check_func()
        log_risk_status(risk_id, status)
```

### 預警觸發條件
```python
ALERT_THRESHOLDS = {
    'gradient_norm_min': 1e-12,  # 梯度消失
    'gradient_norm_max': 1e12,   # 梯度爆炸
    'conservation_error_max': 1e-3,  # 守恆律違反
    'pressure_drift_max': 0.1,   # 壓力漂移
    'reynolds_number_max': 5000   # 高雷諾數警告
}
```

---

## 應急響應計畫

### 緊急風險 (🚨) 響應
1. **立即停止相關開發**
2. **專案團隊緊急會議**
3. **24小時內提供修復方案**
4. **修復後完整回歸測試**

### 高風險 (🔥) 響應  
1. **1-3天內制定詳細修復計畫**
2. **分配專門資源處理**
3. **每日進度檢查**
4. **修復後擴展測試覆蓋**

### 中/低風險 (⚠️🟡) 響應
1. **納入後續開發計畫**
2. **定期監控與評估**  
3. **適時調整優先級**

---

## 風險審查週期

- **每日**: 極高/高風險狀態檢查
- **每週**: 中風險評估與更新
- **每月**: 低風險審查與新風險識別
- **每季**: 風險登記表全面更新

---

**最後更新**: 2025-09-30  
**下次審查**: 2025-10-01  
**版本**: v1.0  
**批准**: Physicist Sub-Agent